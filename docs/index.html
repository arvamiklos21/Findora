<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz</title>
  <meta name="description" content="A Findora seg√≠t megtal√°lni a legjobb akci√≥kat √©s aj√°nlatokat." />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="icon" href="assets/img/findora_mark.png" />

  <!-- OG/Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Findora" />
  <meta property="og:title" content="Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz" />
  <meta property="og:description" content="V√°logatott akci√≥k √©s aj√°nlatok." />
  <meta property="og:image" content="assets/img/findora-header.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz" />
  <meta name="twitter:description" content="A legjobb akci√≥k √©s kuponok egy helyen." />
  <meta name="twitter:image" content="assets/img/findora-header.png" />

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#0077FF; --brand2:#00BBFF; --bg:#f7f9fc; --text:#0f172a; --muted:#64748b;
      --card:#ffffff; --panel:#ffffffee; --border:#e2e8f0; --panel-blur: 12px;
      --pine-row:url("data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='480' height='120' viewBox='0 0 480 120'><defs><linearGradient id='fog' x1='0' x2='0' y1='0' y2='1'><stop offset='0' stop-color='%230b1a33' stop-opacity='0.0'/><stop offset='1' stop-color='%230b1a33' stop-opacity='0.35'/></linearGradient></defs><rect width='480' height='120' fill='url(%23fog)'/><g fill='%23152a4a' opacity='0.75'><path d='M10,110 l20,-40 l20,40 z'/><path d='M60,110 l22,-44 l22,44 z'/><path d='M120,110 l18,-36 l18,36 z'/><path d='M170,110 l24,-48 l24,48 z'/><path d='M230,110 l20,-42 l20,42 z'/><path d='M290,110 l22,-44 l22,44 z'/><path d='M350,110 l18,-36 l18,36 z'/><path d='M400,110 l24,-48 l24,48 z'/></g></svg>");
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
      background:
        radial-gradient(1200px 700px at 12% -10%, rgba(0,119,255,.08), transparent 60%),
        radial-gradient(900px 600px at 110% -10%, rgba(0,187,255,.06), transparent 60%),
        var(--pine-row) bottom center/900px 220px repeat-x,
        var(--bg);
      background-attachment: fixed,fixed,fixed,fixed;
      overflow-x:hidden;
    }
    @media (max-width:640px){ body{ background-attachment: scroll,scroll,scroll,scroll; } }

    .hero{
      position:relative; z-index:3; color:#0f172a; text-align:center; padding:58px 10px 22px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.85) 0%, rgba(255,255,255,.78) 60%, rgba(255,255,255,.75) 100%),
        url('assets/img/findora-header.png') center/cover no-repeat;
      border-bottom:1px solid rgba(226,232,240,.7);
    }
    .hero-inner{max-width:1100px;margin:0 auto}
    .brand{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:10px}
    .brand img{height:44px;border-radius:12px;background:#fff;box-shadow:0 2px 8px rgba(2,6,23,.08);border:1px solid var(--border)}
    .hero h1{font-size:clamp(20px,3.5vw,32px);font-weight:800}
    .hero p{font-size:clamp(13px,1.7vw,16px); color:#334155}
    .dev-badge{position:absolute;left:12px;top:12px;background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;padding:6px 10px;border-radius:10px;font-weight:700;font-size:13px;box-shadow:0 4px 14px rgba(0,119,255,.25)}
    .promo{margin:10px auto;background:#ffffffcc;color:#0f172a;padding:8px 12px;border-radius:14px;max-width:860px;font-weight:700;border:1px solid rgba(2,6,23,.06);backdrop-filter:saturate(140%) blur(6px)}

    .gift-row{display:flex;gap:8px;justify-content:center;margin-top:10px}
    .gift{width:26px;height:26px;position:relative;transform:rotate(3deg);filter:drop-shadow(0 6px 10px rgba(0,0,0,.12))}
    .gift:before,.gift:after{content:"";position:absolute;inset:0;border-radius:4px}
    .gift:before{background:linear-gradient(145deg,#fff,#ddd)}
    .gift:after{
      background:
        linear-gradient(0deg,transparent 45%, rgba(0,0,0,.06) 46% 54%, transparent 55%),
        linear-gradient(90deg,#e11d48,#e11d48);
      border-radius:4px}
    .gift .bow{position:absolute;top:-9px;left:50%;width:18px;height:10px;transform:translateX(-50%);border-radius:10px;background:radial-gradient(circle at 30% 40%, #ff7096, #e11d48)}

    .promo-banners{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:1100px;margin:10px auto 0;padding:0 10px}
    .pb-card{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:14px;text-decoration:none;background:#fff;border:1px solid rgba(2,6,23,.06);box-shadow:0 6px 14px rgba(2,6,23,.08);color:#0f172a}
    .pb-eyebrow{display:block;font-size:12px;letter-spacing:.06em;opacity:.85}
    .pb-title{display:block;font-weight:900;font-size:18px;line-height:1}
    .pb-cta{font-weight:800;font-size:13px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.9)}
    .pb-card.xmas{background:linear-gradient(90deg,#e11d48,#ef4444);color:#fff;border-color:transparent}
    .pb-card.bf{background:radial-gradient(120% 120% at 0% 0%, #111 0%, #000 60%);color:#e5e7eb;border-color:#111}
    .pb-card.bf .pb-cta{background:#111;color:#fff;border:1px solid #222}
    .pb-card.bf .pb-count{font-variant-numeric:tabular-nums;font-weight:900;letter-spacing:.02em;background:#0a0a0a;border:1px solid #1f2937;padding:6px 8px;border-radius:8px}
    @media (max-width:760px){ .promo-banners{grid-template-columns:1fr} }

    .topbar-wrap{position:sticky; top:0; z-index:40; backdrop-filter: blur(var(--panel-blur)); background:rgba(255,255,255,.7); border-bottom:1px solid rgba(226,232,240,.8)}
    .topbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:center;margin:0 auto;max-width:1100px;padding:8px 6px}
    .categories{display:flex;gap:8px;justify-content:center;overflow-x:auto;padding:0 6px}
    .catbtn{border:1px solid #dbeafe;background:#ffffffc9;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:700;font-size:14px;white-space:nowrap}
    .catbtn.active{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;border-color:#cfe6ff}

    .searchbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center;margin:8px 0 0}
    .searchbar input,.searchbar button{padding:10px;border:none;border-radius:10px;font-size:14px}
    .searchbar input{min-width:220px;max-width:360px;flex:1;padding-left:36px;background:#fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="%2399a1ad"><path d="M21 20l-5.6-5.6a7 7 0 10-1.4 1.4L20 21l1-1zM10 16a6 6 0 110-12 6 6 0 010 12z"/></svg>') no-repeat 10px center;background-size:18px 18px; border:1px solid var(--border)}
    .searchbar button{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#ffffff;font-weight:800;cursor:pointer;box-shadow:0 8px 18px rgba(0,119,255,.18)}

    /* mini nav */
    .nav-mini{position:fixed;right:12px;bottom:70px;display:flex;gap:8px;z-index:60}
    .nav-mini button{background:#ffffff;border:1px solid #e2e8f0;border-radius:999px;padding:8px 12px;font-weight:800;box-shadow:0 8px 22px rgba(2,6,23,.22);cursor:pointer}

    main{max-width:1200px;margin:22px auto;padding:0 12px; position:relative; z-index:2}
    .section{
      background:var(--panel); border:1px solid rgba(226,232,240,.85); border-radius:18px; margin-bottom:24px; box-shadow:0 10px 24px rgba(2,6,23,.10); overflow:hidden;
      content-visibility:auto; contain-intrinsic-size: 1000px 800px;
    }
    .section h2{font-size:18px;padding:10px 12px;border-bottom:1px solid #e2e8f0;background:linear-gradient(90deg,#eef6ff,#fff)}
    .section h3{font-size:16px;padding:8px 12px 0;color:#0f172a}

    .grid{display:flex; flex-wrap:wrap; gap:12px; padding:12px}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:14px; overflow:hidden;
      display:flex; flex-direction:column; min-width:220px;
      flex:1 1 calc(25% - 12px); max-width:calc(25% - 12px)
    }
    .card:hover{transform:translateY(-3px); box-shadow:0 14px 26px rgba(2,6,23,.16)}
    @media (max-width:900px){ .card{ flex:1 1 calc(33.333% - 12px); max-width:calc(33.333% - 12px); } }
    @media (max-width:640px){ .card{ flex:1 1 calc(50% - 12px); max-width:calc(50% - 12px); } }
    @media (max-width:420px){ .card{ flex:1 1 100%; max-width:100%; } }

    .thumb{height:130px;background:#eef2f7;display:flex;align-items:center;justify-content:center}
    .title{font-weight:800;margin:10px;font-size:14px;line-height:1.25;text-align:center;color:#475569}
    .price{margin:6px 12px 0; font-weight:900; text-align:center}
    .cta{display:inline-block; margin:10px auto 12px; background:linear-gradient(90deg,var(--brand),var(--brand2)); color:#fff; padding:8px 12px; border-radius:10px; font-weight:800; text-decoration:none}
    .empty{padding:18px;color:#64748b}

    footer{text-align:center;padding:20px;background:#0b3a6a;color:#fff;margin-top:24px;font-size:14px;border-top:1px solid rgba(255,255,255,.15)}

    .snow{pointer-events:none;position:fixed;inset:0;overflow:hidden;z-index:1}
    .flake{position:absolute;top:-10px;width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.9);filter:blur(.5px);animation:fall linear infinite}
    @keyframes fall{0%{transform:translateY(-10px)}100%{transform:translateY(110vh)}}

    #searchProgress{display:none; margin:6px auto 0; font-size:12px; color:#334155; background:#fff; border:1px solid var(--border); border-radius:10px; padding:6px 10px; width:max-content}
  </style>
</head>
<body>
  <div class="snow" aria-hidden="true"></div>

  <header class="hero">
    <span class="dev-badge">Folyamatos fejleszt√©s</span>
    <div class="hero-inner">
      <div class="brand">
        <img id="brandLogo" src="assets/img/findora-header.png" alt="Findora log√≥" />
        <div>
          <h1>Findora</h1>
          <p>Ir√°nyt mutat a legjobb aj√°nlatokhoz</p>
        </div>
      </div>

      <div class="gift-row" aria-hidden="true">
        <div class="gift"><div class="bow"></div></div>
        <div class="gift" style="transform:rotate(-4deg)"><div class="bow"></div></div>
        <div class="gift" style="transform:rotate(2deg)"><div class="bow"></div></div>
        <div class="gift" style="transform:rotate(-6deg)"><div class="bow"></div></div>
      </div>

      <div class="promo" role="note">üéÑ √únnepi hangulat, friss aj√°nlatokkal! ‚Äì A partnerek statikus feedr≈ël t√∂ltenek, gyors bet√∂lt√©ssel.</div>

      <div class="promo-banners" role="region" aria-label="Kiemelt akci√≥k">
        <a class="pb-card xmas" href="#akciok" aria-label="Kar√°csonyi √∂tletek">
          <div><span class="pb-eyebrow">Merry</span><span class="pb-title">Christmas</span></div>
          <div><span class="pb-cta">Aj√°nd√©k-√∂tletek ¬ª</span></div>
        </a>
        <a class="pb-card bf" href="#akciok" aria-label="Black Friday">
          <div><span class="pb-eyebrow">Black</span><span class="pb-title">Friday</span></div>
          <div><span class="pb-count" id="bfCountdown">Bet√∂lt√©s‚Ä¶</span><span class="pb-cta">Legjobb √°rak ¬ª</span></div>
        </a>
      </div>
    </div>

    <div class="topbar-wrap">
      <div class="topbar">
        <nav class="categories" aria-label="Kateg√≥ri√°k">
          <button class="catbtn active" data-cat="all">F≈ëoldal</button>
          <button class="catbtn" data-cat="home">üè† Otthon</button>
          <button class="catbtn" data-cat="games">üïπÔ∏è J√°t√©kok</button>
          <button class="catbtn" data-cat="tech">üíª Tech</button>
          <button class="catbtn" data-cat="vision">üëì L√°t√°s</button>
          <button class="catbtn" data-cat="travel">‚úàÔ∏è Utaz√°s</button>
        </nav>

        <form id="searchFormAll" class="searchbar" role="search" action="">
          <input id="qAll" name="q" type="search" placeholder="Keres√©s az √∂sszes partnerben‚Ä¶" aria-label="Keres√©s (glob√°lis)" />
          <button type="submit" aria-label="Keres√©s ind√≠t√°sa">Keres√©s</button>
        </form>
        <div id="searchProgress">Keres√©s‚Ä¶</div>
      </div>
    </div>
  </header>

  <!-- mini nav -->
  <div class="nav-mini">
    <button id="homeBtn" title="F≈ëoldal">Home</button>
    <button id="backBtn" title="Vissza">Vissza</button>
  </div>

  <main>
    <!-- ========= AKCI√ìS BLOKKOK ‚Äì MINDEN PARTNERB≈êL ========= -->
    <section class="section" id="akciok">
      <h2>Akci√≥k (minden partner)</h2>

      <div class="section">
        <h2>üéÅ √únnepi aj√°nlatok Boltokt√≥l</h2>
        <div class="grid" id="xmas-list"></div>
        <div class="grid" id="xmas-nav" style="padding-top:0"></div>
      </div>

      <div class="section">
        <h2>‚àí10‚Äì24% le√©rt√©kel√©s</h2>
        <div class="grid" id="sale10-list"></div>
        <div class="grid" id="sale10-nav" style="padding-top:0"></div>
      </div>

      <div class="section">
        <h2>‚ö° ‚àí25‚Äì49% le√°raz√°s</h2>
        <div class="grid" id="sale25-list"></div>
        <div class="grid" id="sale25-nav" style="padding-top:0"></div>
      </div>

      <div class="section">
        <h2>üí• Hihetetlen ‚àí50%+</h2>
        <div class="grid" id="sale50-list"></div>
        <div class="grid" id="sale50-nav" style="padding-top:0"></div>
      </div>
    </section>

    <!-- ========= F≈êOLDAL ‚Äì MULTI-PARTNER AJ√ÅNLATOK (6/lap / partner) ========= -->
    <section class="section" id="osszes">
      <h2>Aj√°nlatok</h2>
      <div id="home-multi">
        <div class="grid"><div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div></div>
      </div>
    </section>

    <!-- ========= OTTHON ‚Äì TCHIBO (6/lap + Teljes 20/lap) ========= -->
    <section class="section" id="otthon">
      <h2><a href="#partner-full" id="home-cat-head-link" style="text-decoration:underline;font-weight:900;">Otthon</a></h2>

      <div class="grid" id="home-cat-list">
        <div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div>
      </div>
      <div id="home-cat-nav" class="grid" style="padding-top:0"></div>

      <!-- 20/lap teljes ‚Äì partner keres≈ëvel (OTTHON alatt) -->
      <div id="partner-full-wrap" style="display:none; padding:12px;">
        <form id="searchFormPartner" class="searchbar" role="search" action="" style="margin:0 0 8px">
          <input id="qPartner" name="qPartner" type="search" placeholder="Keres√©s a term√©kek k√∂z√∂tt‚Ä¶" aria-label="Keres√©s (Partner)" />
          <button type="submit" aria-label="Keres√©s ind√≠t√°sa">Keres√©s</button>
        </form>
        <div class="grid" id="partner-full-list"></div>
        <div id="partner-full-nav" class="grid" style="padding-top:0"></div>
      </div>
    </section>

    <!-- ========= J√ÅT√âKOK ‚Äì J√°t√©ksziget + REGIO (6/lap + Teljes 20/lap) ========= -->
    <section class="section" id="games">
      <h2>J√°t√©kok</h2>
      <div id="games-partners"><div class="grid"><div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div></div></div>
    </section>

    <!-- A t√∂bbi kateg√≥ria szekci√≥ rejtve -->
    <section class="section" id="tech" style="display:none"></section>
    <section class="section" id="vision" style="display:none"></section>
    <section class="section" id="travel" style="display:none"></section>
  </main>

  <footer>
    ¬© 2025 Findora ‚Ä¢ Az oldalon affiliate linkek lehetnek.
  </footer>

  <script>
    // ===== apr√≥ vizu√°lok =====
    (function snow(){
      const wrap=document.querySelector('.snow');
      const isMobile = matchMedia('(max-width: 640px)').matches;
      const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const COUNT = prefersReduced ? 0 : (isMobile ? 14 : 28);
      for(let i=0;i<COUNT;i++){
        const f=document.createElement('div');
        f.className='flake';
        f.style.left = Math.random()*100 + 'vw';
        const dur = (isMobile ? 10 : 8) + Math.random()*10;
        f.style.animationDuration = dur + 's';
        f.style.animationDelay = (Math.random()*-dur) + 's';
        f.style.opacity = (0.45 + Math.random()*0.35).toFixed(2);
        const size = (isMobile ? 1.5 : 2) + Math.random()*4;
        f.style.width = f.style.height = size + 'px';
        wrap.appendChild(f);
      }
    })();

    document.getElementById('homeBtn').onclick = ()=>location.href = location.origin + location.pathname;
    document.getElementById('backBtn').onclick = ()=>history.back();

    (function promoLogicTZ(){
      const now = new Date();
      const y = now.getFullYear();
      function lastFridayOfNovember(year){
        const d = new Date(year, 10, 30);
        while(d.getDay() !== 5){ d.setDate(d.getDate()-1); }
        d.setHours(0,0,0,0);
        return d;
      }
      const bfDate = lastFridayOfNovember(y);
      const el = document.getElementById('bfCountdown');
      if(el){
        const pad = n => String(n).padStart(2,'0');
        function tick(){
          const now = new Date();
          const diff = bfDate - now;
          if(diff <= 0){ el.textContent = "Ma!"; return; }
          const d = Math.floor(diff/86400000);
          const h = Math.floor((diff%86400000)/3600000);
          const m = Math.floor((diff%3600000)/60000);
          el.textContent = `${pad(d)} nap ${pad(h)}:${pad(m)}`;
          setTimeout(tick, 20000);
        }
        tick();
      }
    })();

    // ===== helpers & state =====
    const API_BASE = location.hostname.endsWith('findora.hu') ? 'https://www.findora.hu' : location.origin;
    const partnersUrl = '/feeds/partners.json'; // els≈ëdleges c√©l

    // --- DEBUG UI: l√°that√≥ hiba√ºzenet banner ---
    function showFatal(msg) {
      const b = document.createElement('div');
      b.style.cssText = "position:fixed;left:12px;bottom:12px;max-width:90vw;background:#fee2e2;color:#7f1d1d;border:1px solid #fecaca;border-radius:10px;padding:10px 12px;z-index:9999;font:14px/1.3 system-ui,sans-serif;box-shadow:0 8px 24px rgba(0,0,0,.15)";
      b.innerHTML = "‚ùå Hiba: " + msg + "<br><small>R√©szletek: F12 ‚Üí Console/Network.</small>";
      document.body.appendChild(b);
    }

    // --- partners.json el√©r√©s intelligens felold√°sa + cache t√∂r√©s ---
    const partnersCandidates = [
      partnersUrl,
      (location.pathname.replace(/\/[^/]*$/, '') || '') + '/feeds/partners.json',
      (location.pathname.startsWith('/Findora') ? '/Findora/feeds/partners.json' : null)
    ].filter(Boolean);

    async function fetchFirstAvailable(urls){
      const v = Date.now();
      for(const u of urls){
        try{
          const r = await fetch(u + (u.includes('?') ? '&' : '?') + 'v=' + v, { cache:'no-cache' });
          if(r.ok) return await r.json();
          console.warn('partners.json pr√≥b√°lva, st√°tusz:', r.status, u);
        }catch(e){
          console.warn('partners.json fetch hiba:', u, e);
        }
      }
      throw new Error('Egyik partners.json √∫tvonal sem √©rhet≈ë el: ' + urls.join(', '));
    }

    const PARTNERS = new Map();
    const META     = new Map();
    const PAGES    = new Map();
    const DL = (partner, raw) => `${API_BASE}/api/dl?u=${encodeURIComponent(raw)}&p=${partner}`;

    let CURRENT_OTTHON_PARTNER = null;
    const GAMES_STATE = new Map();

    let HOME_PARTNERS = [];
    let DEFAULT_PARTNER = null;
    const SCAN_PAGES_FOR_SALES = 2; // akci√≥-blokkokn√°l partnerenk√©nt ennyi forr√°st olvasunk

    const pageUrl = (partnerCfg, n) => partnerCfg.pagePattern.replace('{NNNN}', String(n).padStart(4,'0'));
    const priceText = (v) => Number.isFinite(v) ? (v.toLocaleString('hu-HU') + ' Ft') : (typeof v==='string' && v.trim() ? v : '‚Äî');
    const firstUrl  = (it) => it?.url || it?.link || it?.deeplink || '';

    // ===== ER≈êS DEDUP mindenhol =====
    const SIZE_TOKENS = /(?:\b(?:XXS|XS|S|M|L|XL|XXL|3XL|4XL|5XL)\b|\b\d{2}(?:-\d{2})?\b)/gi;
    function normalizeTitleNoSize(t){
      if(!t) return '';
      return String(t).replace(SIZE_TOKENS,'').replace(/\s{2,}/g,' ').trim().toLowerCase();
    }
    function basePath(u){
      try{ const x=new URL(u); return x.origin + x.pathname; }catch(_){ return String(u||'').split('#')[0].split('?')[0]; }
    }
    function imgPath(u){ return String(u||'').split('#')[0].split('?')[0]; }
    function stripVariantParams(u){
      if(!u) return u;
      try{
        const x=new URL(u);
        const drop=['size','meret','merete','variant_size','size_id','meret_id','option','variant'];
        for(const k of [...x.searchParams.keys()]){
          if(drop.includes(k.toLowerCase())) x.searchParams.delete(k);
        }
        return x.toString();
      }catch(_){ return u; }
    }
    function dedupeStrong(items){
      const out=[], seen=new Set();
      for(const it of (items||[])){
        const raw = firstUrl(it);
        const key = basePath(stripVariantParams(raw)) + '|' + imgPath(it?.img||'') + '|' + normalizeTitleNoSize(it?.title||'');
        if(!seen.has(key)){ seen.add(key); out.push(it); }
      }
      return out;
    }

    // ===== oldalbet√∂lt≈ëk =====
    async function getMeta(partnerId){
      if(META.has(partnerId)) return META.get(partnerId);
      const cfg = PARTNERS.get(partnerId);
      const r = await fetch(cfg.meta, {cache:'no-cache'});
      if(!r.ok) throw new Error(`${partnerId} meta.json nem el√©rhet≈ë`);
      const m = await r.json();
      META.set(partnerId, m);
      return m;
    }
    async function getPageItems(partnerId, pageNum){
      if(!PAGES.has(partnerId)) PAGES.set(partnerId, new Map());
      const store = PAGES.get(partnerId);
      const key = `page-${String(pageNum).padStart(4,'0')}`;
      if(store.has(key)) return store.get(key);
      const cfg = PARTNERS.get(partnerId);
      const r = await fetch(pageUrl(cfg, pageNum), {cache:'no-cache'});
      if(!r.ok) throw new Error(`${partnerId} ${key} nem el√©rhet≈ë`);
      const d = await r.json();
      const arr = d?.items || [];
      store.set(key, arr);
      return arr;
    }
    async function collectUnique(partnerId, offset, want){
      const meta = await getMeta(partnerId);
      const srcSize = meta.pageSize || 300;
      const total = meta.total ?? (meta.pages*srcSize) || 0;
      const start = Math.max(0, offset|0);
      const acc=[];
      let i=start;
      while(acc.length < want && i < total){
        const pageNum = Math.floor(i/srcSize) + 1;
        const inner   = i % srcSize;
        const arr = await getPageItems(partnerId, pageNum);
        for(let k=inner; k<arr.length && acc.length<want; k++){
          acc.push(arr[k]);
        }
        i = pageNum*srcSize;
      }
      return dedupeStrong(acc).slice(0, want);
    }

    // ===== k√°rtya render =====
    const renderCards = (partnerId, items)=>{
      const cfg = PARTNERS.get(partnerId);
      const list = dedupeStrong(items);
      return list.map(it=>{
        const raw = firstUrl(it);
        return `
          <div class="card">
            <div class="thumb">
              ${it?.img ? `<img src="${it.img}" alt="" loading="lazy" style="max-width:100%;max-height:100%">` : 'üõçÔ∏è'}
            </div>
            <div class="title">${it?.title || ''}</div>
            <div class="price">${priceText(it?.price)}</div>
            ${raw ? `<a class="cta" href="${DL(cfg.deeplinkPartner, raw)}" target="_blank" rel="nofollow sponsored noopener noreferrer">Megn√©zem</a>` : ''}
          </div>`;
      }).join('');
    };

    // t√∂bb partnerb≈ël kevert lista
    function renderMixedCards(itemsWithPid){
      const list = itemsWithPid;
      return (list||[]).map(r=>{
        const cfg = PARTNERS.get(r.pid);
        const it  = r.item;
        const raw = firstUrl(it);
        return `
          <div class="card">
            <div class="thumb">
              ${it?.img ? `<img src="${it.img}" alt="" loading="lazy" style="max-width:100%;max-height:100%">` : 'üõçÔ∏è'}
            </div>
            <div class="title">${it?.title || ''}</div>
            <div class="price">${priceText(it?.price)}</div>
            <div class="title" style="color:#64748b;font-weight:700;font-size:12px;margin-top:0">‚Ä¢ ${cfg?.name||r.pid}</div>
            ${raw ? `<a class="cta" href="${DL(cfg.deeplinkPartner, raw)}" target="_blank" rel="nofollow sponsored noopener noreferrer">Megn√©zem</a>` : ''}
          </div>`;
      }).join('');
    }

    // Akt√≠v partnerek
    function enabledPartners(){
      const arr = Array.from(PARTNERS.values());
      const enabled = arr.filter(p=>{
        const plc = p.placements||{};
        return Object.values(plc).some(v => (v && v.enabled) || (v?.full?.enabled));
      });
      return enabled;
    }

    // ===== Akci√≥ blokkok ‚Äì minden partner =====
    function getDiscountNumber(it){
      if(Number.isFinite(it?.discount)) return it.discount;
      const txt = ((it?.title||'')+' '+(it?.desc||'')).toLowerCase();
      const m = txt.match(/-?\s?(\d{1,3})\s?%/);
      return m ? parseInt(m[1],10) : null;
    }
    function paginate(arr, size){ const pages=[]; for(let i=0;i<arr.length;i+=size) pages.push(arr.slice(i,i+size)); return pages.length?pages:[[]]; }
    function renderPagedBlockMixed(itemsWithPid, listElId, navElId){
      const PAGE=6;
      const deduped = dedupeStrong(itemsWithPid.map(x=>x.item)).map(it=>{
        const raw = firstUrl(it);
        const pid = itemsWithPid.find(y=>firstUrl(y.item)===raw)?.pid || 'unknown';
        return {pid, item: it};
      });
      const pages = paginate(deduped, PAGE);
      let cur=1;
      function draw(){
        const list=document.getElementById(listElId);
        const nav =document.getElementById(navElId);
        list.innerHTML = pages[cur-1].length ? renderMixedCards(pages[cur-1]) : '<div class="empty">Sajnos nincsennek Akci√≥k !! :(</div>';
        const fnName = listElId.replace(/-/g,'_')+'_pager';
        nav.innerHTML = `
          <button class="cta" ${cur<=1?'disabled':''} onclick="(${fnName}).go(${cur-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none">${cur}/${pages.length}</span>
          <button class="cta" ${cur>=pages.length?'disabled':''} onclick="(${fnName}).go(${cur+1})">K√∂vetkez≈ë</button>`;
        window[fnName] = { go:(n)=>{ cur=n; draw(); } };
      }
      draw();
    }
    async function buildSaleBlocksAll(){
      try{
        const actives = enabledPartners();
        const collected = []; // {pid,item}

        for(const p of actives){
          const meta = await getMeta(p.id);
          const srcSize = meta.pageSize || 300;
          const scanPages = Math.min(SCAN_PAGES_FOR_SALES, meta.pages || Math.ceil((meta.total||0)/srcSize) || 1);
          for(let pg=1; pg<=scanPages; pg++){
            const arr = await getPageItems(p.id, pg);
            for(const it of arr){
              collected.push({ pid:p.id, item: it });
            }
          }
        }

        const in10 = collected.filter(r=>{ const d=getDiscountNumber(r.item); return d!==null && d>=10 && d<=24; });
        const in25 = collected.filter(r=>{ const d=getDiscountNumber(r.item); return d!==null && d>=25 && d<=49; });
        const in50 = collected.filter(r=>{ const d=getDiscountNumber(r.item); return d!==null && d>=50;  });
        const xmas = collected.filter(r=>{
          const it=r.item;
          const txt=((it?.title||'')+' '+(it?.desc||'')).toLowerCase();
          return /kar√°csony|xmas|√ºnnepi|aj√°nd√©k/.test(txt);
        });

        renderPagedBlockMixed(xmas, 'xmas-list','xmas-nav');
        renderPagedBlockMixed(in10, 'sale10-list','sale10-nav');
        renderPagedBlockMixed(in25, 'sale25-list','sale25-nav');
        renderPagedBlockMixed(in50, 'sale50-list','sale50-nav');
      }catch(e){
        console.warn('Akci√≥ blokkok hiba', e);
        ['xmas-list','sale10-list','sale25-list','sale50-list'].forEach(id=>{
          const el=document.getElementById(id);
          if(el) el.innerHTML = '<div class="empty">Sajnos nincsennek Akci√≥k !! :(</div>';
        });
      }
    }

    // ===== partners bet√∂lt√©s (JAV√çTVA) =====
    async function loadPartners(){
      try{
        const arr = await fetchFirstAvailable(partnersCandidates);
        if (!Array.isArray(arr) || !arr.length) {
          throw new Error('partners.json √ºres vagy hib√°s form√°tum');
        }
        PARTNERS.clear();
        for(const p of arr){
          if(!p.id || !p.meta || !p.pagePattern || !p.deeplinkPartner){
            console.error('Hib√°s partner objektum:', p);
            throw new Error('Hib√°s partner (k√∂telez≈ë: id, meta, pagePattern, deeplinkPartner)');
          }
          PARTNERS.set(p.id, p);
        }
        HOME_PARTNERS = arr.filter(p=>p.placements?.home?.enabled);
        DEFAULT_PARTNER = HOME_PARTNERS[0]?.id || arr.find(p=>p.placements?.home?.enabled)?.id || arr[0]?.id || null;
        console.log('PARTNEREK BET√ñLTVE:', PARTNERS);
      }catch(e){
        showFatal(e.message);
        throw e;
      }
    }

    // ===== F≈ëoldal ‚Äì t√∂bb partner doboz =====
    function homeBoxTemplate(p){
      const pid = p.id;
      return `
        <div class="section" id="home-box-${pid}">
          <h3>${p.name}</h3>
          <div class="grid" id="home-${pid}-list">
            <div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div>
          </div>
          <div class="grid" id="home-${pid}-nav" style="padding-top:0"></div>
        </div>`;
    }
    async function drawHomeOverviewFor(pid, page=1){
      const p = PARTNERS.get(pid);
      if(!p) return;
      const PAGE = p.placements?.home?.pageSize || 6;
      try{
        const items = await collectUnique(pid, (page-1)*PAGE, PAGE);
        const meta = await getMeta(pid);
        const totalPages = Math.max(1, Math.ceil((meta.total||0)/PAGE));
        const listEl = document.getElementById(`home-${pid}-list`);
        const navEl  = document.getElementById(`home-${pid}-nav`);
        listEl.innerHTML = renderCards(pid, items) || '<div class="empty">Nincs megjelen√≠thet≈ë aj√°nlat.</div>';
        navEl.innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="drawHomeOverviewFor('${pid}',${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="drawHomeOverviewFor('${pid}',${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById(`home-${pid}-list`).innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni.</div>';
      }
    }
    async function drawHomeTab(){
      const host = document.getElementById('home-multi');
      const list = HOME_PARTNERS.length ? HOME_PARTNERS : enabledPartners();
      if(!list.length){
        host.innerHTML = '<div class="grid"><div class="empty">Nincs ‚ÄûF≈ëoldal‚Äù partner konfigur√°lva.</div></div>';
        return;
      }
      host.innerHTML = list.map(p=>homeBoxTemplate(p)).join('');
      for(const p of list){
        await drawHomeOverviewFor(p.id, 1);
      }
    }

    // ===== Otthon ‚Äì Tchibo (6/lap + 20/lap) =====
    function showHomeOverviewInOtthon(){
      document.getElementById('home-cat-list').style.display='';
      document.getElementById('home-cat-nav').style.display='';
      document.getElementById('partner-full-wrap').style.display='none';
    }
    function showHomeFullInOtthon(){
      document.getElementById('home-cat-list').style.display='none';
      document.getElementById('home-cat-nav').style.display='none';
      document.getElementById('partner-full-wrap').style.display='';
    }
    async function drawOtthonOverview(page=1){
      const partner = Array.from(PARTNERS.values()).find(p=>p.group==='otthon' && p.placements?.otthon?.enabled);
      if(!partner){
        document.getElementById('home-cat-list').innerHTML =
          '<div class="empty">Nincs ‚ÄûOtthon‚Äù partner konfigur√°lva a partners.json-ban.</div>';
        document.getElementById('home-cat-nav').innerHTML = '';
        return;
      }
      CURRENT_OTTHON_PARTNER = partner;
      const PAGE = partner.placements?.otthon?.pageSize || 6;
      try{
        const items = await collectUnique(partner.id, (page-1)*PAGE, PAGE);
        const meta  = await getMeta(partner.id);
        const totalPages = Math.max(1, Math.ceil((meta.total||0)/PAGE));

        const headLink = document.getElementById('home-cat-head-link');
        headLink.textContent = partner.name;
        const canFull = !!partner.placements?.otthon?.full?.enabled;
        headLink.style.pointerEvents = canFull ? '' : 'none';
        headLink.style.textDecoration = canFull ? 'underline' : 'none';

        document.getElementById('home-cat-list').innerHTML =
          renderCards(partner.id, items) || '<div class="empty">Nincs megjelen√≠thet≈ë aj√°nlat.</div>';

        document.getElementById('home-cat-nav').innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="drawOtthonOverview(${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="drawOtthonOverview(${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById('home-cat-list').innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni (Otthon).</div>';
      }
    }

    // ===== Teljes n√©zet (Otthon) =====
    let PARTNER_FILTER = '';
    async function drawPartnerFull(page=1){
      const partner = CURRENT_OTTHON_PARTNER && CURRENT_OTTHON_PARTNER.placements?.otthon?.full?.enabled
        ? CURRENT_OTTHON_PARTNER
        : null;
      if(!partner) return;

      const PAGE = partner.placements?.otthon?.full?.pageSize || 20;
      try{
        const meta = await getMeta(partner.id);
        const offset = (page-1)*PAGE;

        let items = await collectUnique(partner.id, offset, PAGE);

        if(PARTNER_FILTER){
          const q = PARTNER_FILTER.toLowerCase();
          const ok = it => ((it?.title||'')+(it?.desc||'')).toLowerCase().includes(q);
          if(!items.some(ok)){
            const buffer = [];
            const totalPages = meta.pages || Math.ceil((meta.total||0)/(meta.pageSize||300)) || 1;
            for(let pg=1; pg<=totalPages && buffer.length< PAGE*6; pg++){
              const arr = await getPageItems(partner.id, pg);
              buffer.push(...arr);
            }
            items = dedupeStrong(buffer).filter(ok).slice(0,PAGE);
          }else{
            items = dedupeStrong(items.filter(ok)).slice(0,PAGE);
          }
        }

        document.getElementById('partner-full-list').innerHTML =
          renderCards(partner.id, items) || '<div class="empty">Nincs tal√°lat.</div>';

        const totalPages = Math.max(1, Math.ceil((meta.total||0)/PAGE));
        document.getElementById('partner-full-nav').innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="drawPartnerFull(${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="drawPartnerFull(${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById('partner-full-list').innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni (teljes).</div>';
      }
    }

    // ===== Games =====
    function gamesBoxTemplate(p){
      const pid = p.id;
      return `
        <div class="section" id="games-box-${pid}">
          <h2><a href="#games-${pid}-full" class="games-head" data-partner="${pid}" style="text-decoration:underline;font-weight:900;">${p.name}</a></h2>
          <div class="grid" id="games-${pid}-list"><div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div></div>
          <div class="grid" id="games-${pid}-nav" style="padding-top:0"></div>

          <div id="games-${pid}-full-wrap" style="display:none; padding:12px;">
            <form class="searchbar games-search" data-partner="${pid}" role="search" action="" style="margin:0 0 8px">
              <input id="qGames-${pid}" type="search" placeholder="Keres√©s a term√©kek k√∂z√∂tt‚Ä¶" aria-label="Keres√©s (${p.name})" />
              <button type="submit" aria-label="Keres√©s ind√≠t√°sa">Keres√©s</button>
            </form>
            <div class="grid" id="games-${pid}-full-list"></div>
            <div class="grid" id="games-${pid}-full-nav" style="padding-top:0"></div>
          </div>
        </div>`;
    }
    function showGamesOverview(pid){
      document.getElementById(`games-${pid}-list`).style.display='';
      document.getElementById(`games-${pid}-nav`).style.display='';
      document.getElementById(`games-${pid}-full-wrap`).style.display='none';
    }
    function showGamesFull(pid){
      document.getElementById(`games-${pid}-list`).style.display='none';
      document.getElementById(`games-${pid}-nav`).style.display='none';
      document.getElementById(`games-${pid}-full-wrap`).style.display='';
    }
    async function drawGamesOverviewFor(pid, page=1){
      const p = PARTNERS.get(pid);
      if(!p) return;
      const PAGE = p.placements?.games?.pageSize || 6;
      try{
        const items = await collectUnique(pid, (page-1)*PAGE, PAGE);
        const meta  = await getMeta(pid);
        const totalPages = Math.max(1, Math.ceil((meta.total||0)/PAGE));
        const listEl = document.getElementById(`games-${pid}-list`);
        const navEl  = document.getElementById(`games-${pid}-nav`);
        listEl.innerHTML = renderCards(pid, items) || '<div class="empty">Nincs megjelen√≠thet≈ë aj√°nlat.</div>';
        navEl.innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="drawGamesOverviewFor('${pid}',${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="drawGamesOverviewFor('${pid}',${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById(`games-${pid}-list`).innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni.</div>';
      }
    }
    async function drawGamesFullFor(pid, page=1){
      const p = PARTNERS.get(pid);
      if(!p || !p.placements?.games?.full?.enabled) return;
      if(!GAMES_STATE.has(pid)) GAMES_STATE.set(pid, { filter:'', page:1 });

      const state = GAMES_STATE.get(pid);
      const PAGE = p.placements?.games?.full?.pageSize || 20;
      try{
        const meta = await getMeta(pid);
        const offset = (page-1)*PAGE;

        let items = await collectUnique(pid, offset, PAGE);

        if(state.filter){
          const q = state.filter.toLowerCase();
          const ok = it => ((it?.title||'')+(it?.desc||'')).toLowerCase().includes(q);
          if(!items.some(ok)){
            const buffer = [];
            const totalPages = meta.pages || Math.ceil((meta.total||0)/(meta.pageSize||300)) || 1;
            for(let pg=1; pg<=totalPages && buffer.length< PAGE*6; pg++){
              const arr = await getPageItems(pid, pg);
              buffer.push(...arr);
            }
            items = dedupeStrong(buffer).filter(ok).slice(0,PAGE);
          }else{
            items = dedupeStrong(items.filter(ok)).slice(0,PAGE);
          }
        }

        document.getElementById(`games-${pid}-full-list`).innerHTML =
          renderCards(pid, items) || '<div class="empty">Nincs tal√°lat.</div>';
        const totalPages = Math.max(1, Math.ceil((meta.total||0)/PAGE));
        document.getElementById(`games-${pid}-full-nav`).innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="drawGamesFullFor('${pid}',${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="drawGamesFullFor('${pid}',${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById(`games-${pid}-full-list`).innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni (teljes).</div>';
      }
    }
    async function drawGamesTab(){
      const games = Array.from(PARTNERS.values()).filter(p=>p.group==='games' && p.placements?.games?.enabled);
      const host = document.getElementById('games-partners');
      if(games.length===0){
        host.innerHTML = '<div class="grid"><div class="empty">Nincs ‚ÄûJ√°t√©kok‚Äù partner konfigur√°lva.</div></div>';
        return;
      }
      host.innerHTML = games.map(g=>gamesBoxTemplate(g)).join('');

      host.querySelectorAll('.games-head').forEach(a=>{
        a.addEventListener('click', (e)=>{
          e.preventDefault();
          const pid = e.currentTarget.dataset.partner;
          const p = PARTNERS.get(pid);
          if(!p?.placements?.games?.full?.enabled) return;
          showGamesFull(pid);
          drawGamesFullFor(pid, 1);
        });
      });

      host.querySelectorAll('form.games-search').forEach(form=>{
        const pid = form.dataset.partner;
        form.addEventListener('submit', (e)=>{
          e.preventDefault();
          const q = (document.getElementById(`qGames-${pid}`).value||'').trim();
          if(!GAMES_STATE.has(pid)) GAMES_STATE.set(pid, { filter:'', page:1 });
          const st = GAMES_STATE.get(pid);
          st.filter = q;
          st.page = 1;
          showGamesFull(pid);
          drawGamesFullFor(pid, 1);
        });
      });

      for(const p of games){
        showGamesOverview(p.id);
        await drawGamesOverviewFor(p.id, 1);
      }
    }

    // ===== Glob√°lis keres≈ë =====
    function matchesNeedle(it, needle){
      const t=(it?.title||'').toLowerCase(), d=(it?.desc||'').toLowerCase();
      return t.includes(needle) || d.includes(needle);
    }
    let SEARCH_RUN_ID = 0;
    const MAX_RESULTS = 600;

    async function runSearchAcrossPartners(q){
      const needle=(q||'').trim().toLowerCase();
      const host = document.getElementById('home-multi');
      host.innerHTML = '<div class="grid"><div class="card"><div class="thumb">üîé</div><div class="title">Keres√©s az √∂sszes partnerben‚Ä¶</div></div></div>';
      const progEl=document.getElementById('searchProgress');

      if(!needle){ progEl.style.display='none'; await drawHomeTab(); return; }

      const actives = enabledPartners();
      const results = [];
      const seen = new Set();
      const myRun = ++SEARCH_RUN_ID;

      try{
        progEl.style.display='inline-block';
        progEl.textContent = `Keres√©s: 0/${actives.length} partner‚Ä¶`;

        let done=0;
        for(const p of actives){
          if(myRun!==SEARCH_RUN_ID) return;
          const meta = await getMeta(p.id);
          const srcSize = meta.pageSize || 300;
          const totalPages = meta.pages || Math.ceil((meta.total||0)/srcSize) || 1;

          for(let pg=1; pg<=totalPages; pg++){
            if(myRun!==SEARCH_RUN_ID) return;
            const arr = await getPageItems(p.id, pg);
            for(const it of arr){
              if(myRun!==SEARCH_RUN_ID) return;
              if(matchesNeedle(it, needle)){
                const key = basePath(stripVariantParams(firstUrl(it))) + '|' + imgPath(it?.img||'') + '|' + normalizeTitleNoSize(it?.title||'');
                if(!seen.has(key)){
                  seen.add(key);
                  results.push({ pid:p.id, item: it });
                  if(results.length>=MAX_RESULTS) break;
                }
              }
            }
            if(results.length>=MAX_RESULTS) break;
          }
          done++;
          progEl.textContent = `Keres√©s: ${done}/${actives.length} partner‚Ä¶ (${results.length} tal√°lat)`;
          if(results.length>=MAX_RESULTS) break;
        }

        progEl.style.display='none';
        host.innerHTML = `<div class="grid">${ results.length ? renderMixedCards(results) : '<div class="empty">Nincs tal√°lat.</div>' }</div>`;
      }catch(e){
        console.error(e);
        progEl.style.display='none';
        host.innerHTML = '<div class="grid"><div class="empty">Hiba t√∂rt√©nt a keres√©s k√∂zben.</div></div>';
      }
    }

    // ===== Tab kezel√©s =====
    function hideAllSections(){
      ['akciok','osszes','otthon','games','tech','vision','travel'].forEach(id=>{
        const s=document.getElementById(id); if(s) s.style.display='none';
      });
      document.querySelectorAll('.catbtn').forEach(b=>b.classList.remove('active'));
    }
    async function switchTab(tab){
      hideAllSections();
      if(tab==='all'){
        document.getElementById('akciok').style.display='block';
        document.getElementById('osszes').style.display='block';
        document.querySelector('.catbtn[data-cat="all"]')?.classList.add('active');
        await drawHomeTab();
      }else if(tab==='home'){
        document.getElementById('otthon').style.display='block';
        document.querySelector('.catbtn[data-cat="home"]')?.classList.add('active');
        showHomeOverviewInOtthon();
        await drawOtthonOverview(1);
      }else if(tab==='games'){
        const sec = document.getElementById('games');
        sec.style.display='block';
        document.querySelector('.catbtn[data-cat="games"]')?.classList.add('active');
        await drawGamesTab();
      }else{
        const sec=document.getElementById(tab); if(sec) sec.style.display='block';
        document.querySelector(`.catbtn[data-cat="${tab}"]`)?.classList.add('active');
      }
    }

    // ===== esem√©nyek =====
    document.getElementById('home-cat-head-link').addEventListener('click', (e)=>{
      const canFull = !!CURRENT_OTTHON_PARTNER?.placements?.otthon?.full?.enabled;
      if(!canFull){ e.preventDefault(); return; }
      e.preventDefault();
      showHomeFullInOtthon();
      drawPartnerFull(1);
    });
    document.getElementById('searchFormAll').addEventListener('submit', (e)=>{
      e.preventDefault(); runSearchAcrossPartners(document.getElementById('qAll').value||'');
    });
    document.getElementById('searchFormPartner').addEventListener('submit', (e)=>{
      e.preventDefault(); PARTNER_FILTER = document.getElementById('qPartner').value||''; drawPartnerFull(1);
    });
    document.querySelectorAll('.categories .catbtn').forEach(btn=>{
      btn.addEventListener('click', ()=>switchTab(btn.dataset.cat));
    });

    // ===== indul√°s (JAV√çTVA: try/catch + hibal√°that√≥s√°g) =====
    (async function init(){
      try{
        await loadPartners();
        await buildSaleBlocksAll();  // Akci√≥k: minden partner
        await switchTab('all');
      }catch(e){
        console.error('Init hiba:', e);
      }
    })();

    // Glob√°lis hibafog√≥k ‚Äì ha b√°rmi elsz√°ll, l√°tod a k√©perny≈ën
    window.addEventListener('error', (ev)=> showFatal(ev.message || 'Ismeretlen hiba'));
    window.addEventListener('unhandledrejection', (ev)=> showFatal((ev.reason && ev.reason.message) || 'Ismeretlen promise hiba'));
  </script>
</body>
</html>
