<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz</title>
  <meta name="description" content="A Findora seg√≠t megtal√°lni a legjobb akci√≥kat √©s aj√°nlatokat: Amazon, J√°t√©kNet, K√§rcher, eOptika, Tchibo, RegioJ√°t√©k, J√°t√©ksziget egy helyen." />
  <meta name="keywords" content="Findora, akci√≥, kedvezm√©ny, Amazon, J√°t√©kNet, K√§rcher, eOptika, Tchibo, RegioJ√°t√©k, J√°t√©ksziget" />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="canonical" href="./" />
  <link rel="alternate" href="./" hreflang="hu" />
  <link rel="icon" href="assets/img/findora_mark.png" />

  <!-- OG/Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Findora" />
  <meta property="og:title" content="Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz" />
  <meta property="og:description" content="V√°logatott akci√≥k √©s aj√°nlatok magyar felhaszn√°l√≥knak. Amazon, J√°t√©kNet, K√§rcher, eOptika, Tchibo, RegioJ√°t√©k, J√°t√©ksziget." />
  <meta property="og:url" content="./" />
  <meta property="og:image" content="assets/img/findora-header.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz" />
  <meta name="twitter:description" content="A legjobb akci√≥k √©s kuponok egy helyen. N√©zd meg a Findora v√°logat√°sait!" />
  <meta name="twitter:image" content="assets/img/findora-header.png" />

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"Findora",
    "url":"./",
    "description":"V√°logatott akci√≥k √©s aj√°nlatok magyar felhaszn√°l√≥knak.",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"./?q={search_term_string}",
      "query-input":"required name=search_term_string"
    },
    "publisher":{
      "@type":"Organization",
      "name":"Findora",
      "logo":{"@type":"ImageObject","url":"assets/img/findora-header.png"}
    }
  }
  </script>

  <!-- Preconnect az API-hoz -->
  <link rel="preconnect" href="https://www.findora.hu" crossorigin>
  <link rel="dns-prefetch" href="https://www.findora.hu">
  <link rel="preconnect" href="https://findora.hu" crossorigin>
  <link rel="dns-prefetch" href="https://findora.hu">

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#0077FF; --brand2:#00BBFF; --bg:#f7f9fc; --text:#0f172a; --muted:#64748b;
      --card:#ffffff; --panel:#ffffffee; --border:#e2e8f0; --panel-blur: 12px;
      --fireplace:url("https://images.unsplash.com/photo-1519682337058-a94d519337bc?w=1600&q=80&auto=format&fit=crop");
      --pine-row:url("data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='480' height='120' viewBox='0 0 480 120'><defs><linearGradient id='fog' x1='0' x2='0' y1='0' y2='1'><stop offset='0' stop-color='%230b1a33' stop-opacity='0.0'/><stop offset='1' stop-color='%230b1a33' stop-opacity='0.35'/></linearGradient></defs><rect width='480' height='120' fill='url(%23fog)'/><g fill='%23152a4a' opacity='0.75'><path d='M10,110 l20,-40 l20,40 z'/><path d='M60,110 l22,-44 l22,44 z'/><path d='M120,110 l18,-36 l18,36 z'/><path d='M170,110 l24,-48 l24,48 z'/><path d='M230,110 l20,-42 l20,42 z'/><path d='M290,110 l22,-44 l22,44 z'/><path d='M350,110 l18,-36 l18,36 z'/><path d='M400,110 l24,-48 l24,48 z'/></g></svg>");
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
      background:
        radial-gradient(1200px 700px at 12% -10%, rgba(0,119,255,.08), transparent 60%),
        radial-gradient(900px 600px at 110% -10%, rgba(0,187,255,.06), transparent 60%),
        var(--pine-row) bottom center/900px 220px repeat-x,
        var(--bg);
      background-attachment: fixed,fixed,fixed,fixed;
      overflow-x:hidden;
    }
    @media (max-width:640px){ body{ background-attachment: scroll,scroll,scroll,scroll; } }

    .hero{
      position:relative; z-index:3; color:#0f172a; text-align:center; padding:58px 10px 22px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.85) 0%, rgba(255,255,255,.78) 60%, rgba(255,255,255,.75) 100%),
        var(--fireplace) center/cover no-repeat;
      border-bottom:1px solid rgba(226,232,240,.7);
    }
    .hero-inner{max-width:1100px;margin:0 auto}
    .brand{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:10px}
    .brand img{height:44px;border-radius:12px;background:#fff;box-shadow:0 2px 8px rgba(2,6,23,.08);border:1px solid var(--border)}
    .hero h1{font-size:clamp(20px,3.5vw,32px);font-weight:800}
    .hero p{font-size:clamp(13px,1.7vw,16px); color:#334155}
    .dev-badge{position:absolute;left:12px;top:12px;background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;padding:6px 10px;border-radius:10px;font-weight:700;font-size:13px;box-shadow:0 4px 14px rgba(0,119,255,.25)}
    .promo{margin:10px auto;background:#ffffffcc;color:#0f172a;padding:8px 12px;border-radius:14px;max-width:860px;font-weight:700;border:1px solid rgba(2,6,23,.06);backdrop-filter:saturate(140%) blur(6px)}

    .gift-row{display:flex;gap:8px;justify-content:center;margin-top:10px}
    .gift{width:26px;height:26px;position:relative;transform:translateZ(0) rotate(3deg);filter:drop-shadow(0 6px 10px rgba(0,0,0,.12))}
    .gift:before,.gift:after{content:"";position:absolute;inset:0;border-radius:4px}
    .gift:before{background:linear-gradient(145deg,#fff,#ddd)}
    .gift:after{
      background:
        linear-gradient(0deg,transparent 45%, rgba(0,0,0,.06) 46% 54%, transparent 55%),
        linear-gradient(90deg,#e11d48,#e11d48);
      mask-image:linear-gradient(#000,#000); border-radius:4px}
    .gift .bow{position:absolute;top:-9px;left:50%;width:18px;height:10px;transform:translateX(-50%);border-radius:10px;background:radial-gradient(circle at 30% 40%, #ff7096, #e11d48)}

    .promo-banners{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:1100px;margin:10px auto 0;padding:0 10px}
    .pb-card{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:14px;text-decoration:none;background:#fff;border:1px solid rgba(2,6,23,.06);box-shadow:0 6px 14px rgba(2,6,23,.08);transition:transform .15s ease, box-shadow .15s ease;color:#0f172a;position:relative;overflow:hidden}
    .pb-card:hover{transform:translateY(-2px); box-shadow:0 12px 24px rgba(2,6,23,.12)}
    .pb-eyebrow{display:block;font-size:12px;letter-spacing:.06em;opacity:.85}
    .pb-title{display:block;font-weight:900;font-size:18px;line-height:1}
    .pb-cta{font-weight:800;font-size:13px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.9)}
    .pb-card.xmas{background:linear-gradient(90deg,#e11d48,#ef4444);color:#fff;border-color:transparent}
    .pb-card.bf{background:radial-gradient(120% 120% at 0% 0%, #111 0%, #000 60%);color:#e5e7eb;border-color:#111}
    .pb-card.bf .pb-cta{background:#111;color:#fff;border:1px solid #222}
    .pb-card.bf .pb-count{font-variant-numeric:tabular-nums;font-weight:900;letter-spacing:.02em;background:#0a0a0a;border:1px solid #1f2937;padding:6px 8px;border-radius:8px}
    @media (max-width:760px){ .promo-banners{grid-template-columns:1fr} }

    .topbar-wrap{position:sticky; top:0; z-index:40; backdrop-filter: blur(var(--panel-blur)); background:rgba(255,255,255,.7); border-bottom:1px solid rgba(226,232,240,.8)}
    .topbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:center;margin:0 auto;max-width:1100px;padding:8px 6px}
    .categories{display:flex;gap:8px;justify-content:center;overflow-x:auto;padding:0 6px}
    .catbtn{border:1px solid #dbeafe;background:#ffffffc9;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:700;font-size:14px;white-space:nowrap}
    .catbtn.active{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;border-color:#cfe6ff}

    .disc-filter{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .df-btn{border:1px solid var(--border); background:#fff; border-radius:999px; padding:8px 12px; font-weight:700; font-size:13px; cursor:pointer}
    .df-btn.active{background:#0f172a;color:#fff;border-color:#0f172a}

    .searchbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center;margin:8px 0 0}
    .searchbar input,.searchbar button{padding:10px;border:none;border-radius:10px;font-size:14px}
    .searchbar input{min-width:220px;max-width:360px;flex:1;padding-left:36px;background:#fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="%2399a1ad"><path d="M21 20l-5.6-5.6a7 7 0 10-1.4 1.4L20 21l1-1zM10 16a6 6 0 110-12 6 6 0 010 12z"/></svg>') no-repeat 10px center;background-size:18px 18px; border:1px solid var(--border)}
    .searchbar button{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#ffffff;font-weight:800;cursor:pointer;box-shadow:0 8px 18px rgba(0,119,255,.18)}
    .floating-search{display:none}
    @media (max-width:640px){
      .floating-search{display:block;position:fixed; right:12px; bottom:12px; z-index:50; background:linear-gradient(90deg,var(--brand),var(--brand2)); color:#fff; font-weight:800; border-radius:999px; padding:10px 14px; box-shadow:0 10px 24px rgba(2,6,23,.22)}
    }

    main{max-width:1200px;margin:22px auto;padding:0 12px; position:relative; z-index:2}
    .layout{display:grid; grid-template-columns:280px 1fr; gap:14px}
    @media (max-width:980px){ .layout{grid-template-columns:1fr} }

    aside.sidebar{
      background:var(--panel); border:1px solid rgba(226,232,240,.85); border-radius:18px; box-shadow:0 10px 24px rgba(2,6,23,.10); overflow:hidden;
      padding:12px;
    }
    .side-title{font-weight:900; font-size:15px; margin-bottom:8px}
    .chip-row{display:flex; flex-wrap:wrap; gap:6px}
    .chip{border:1px solid var(--border); background:#fff; border-radius:999px; padding:6px 10px; font-weight:700; font-size:12px; cursor:pointer}
    .chip.active{background:#0f172a;color:#fff;border-color:#0f172a}
    .side-block{margin-bottom:14px}
    .side-note{font-size:12px; color:#64748b; margin-top:6px}

    .section{
      background:var(--panel); border:1px solid rgba(226,232,240,.85); border-radius:18px; margin-bottom:24px; box-shadow:0 10px 24px rgba(2,6,23,.10); overflow:hidden;
      content-visibility:auto; contain-intrinsic-size: 1000px 800px;
    }
    .section h2{font-size:18px;padding:10px 12px;border-bottom:1px solid #e2e8f0;background:linear-gradient(90deg,#eef6ff,#fff)}
    .section.festive h2{
      background:
        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="220" height="38"><g fill="%23e11d48"><circle cx="18" cy="12" r="3"/><rect x="12" y="17" width="12" height="8" rx="2"/></g><g fill="%2385cb96"><path d="M200 10 l6 6 l-6 6 l-6 -6 z"/></g></svg>') 12px center/auto 28px no-repeat,
        linear-gradient(90deg,#ffe9ef,#fff);
      padding-left:48px;
    }

    .grid{display:flex; flex-wrap:wrap; gap:12px; padding:12px}
    .grid .card{min-width:220px; flex:1 1 calc(25% - 12px); max-width:calc(25% - 12px)}
    @media (max-width:1024px){ .grid .card{flex-basis:calc(33.333% - 12px);max-width:calc(33.333% - 12px)} }
    @media (max-width:760px){ .grid .card{flex-basis:calc(50% - 12px);max-width:calc(50% - 12px)} }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; overflow:hidden; display:flex; flex-direction:column; height:300px; transition:transform .18s ease, box-shadow .18s ease}
    .card:hover{transform:translateY(-3px); box-shadow:0 14px 26px rgba(2,6,23,.16)}
    .thumb{height:130px;background:#eef2f7;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .body{padding:10px;flex-grow:1}
    .title{font-weight:800;margin-bottom:4px;font-size:14px;line-height:1.25}
    .desc{font-size:12px;color:#475569;margin-top:4px;line-height:1.3;max-height:3.1em;overflow:hidden}
    .muted{color:var(--muted);font-size:12px;display:flex;align-items:center;gap:6px;margin-top:6px}
    .price{font-weight:800;margin-top:6px;font-size:14px}
    .cta{margin-top:auto;padding:10px;text-align:center}
    .cta a{display:inline-block;background:linear-gradient(90deg,var(--brand),var(--brand2));padding:8px 12px;border-radius:8px;color:#fff;font-weight:800;box-shadow:0 8px 18px rgba(0,119,255,.18)}

    .toolbar{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 16px;background:#f1f5f9;border-bottom:1px solid #e2e8f0;border-radius:16px 16px 0 0}
    .toolbtn, .toolsel{background:#fff;border:1px solid #e2e8f0;border-radius:10px;padding:8px 10px;font-weight:700;font-size:13px;cursor:pointer}
    .pager{display:flex;gap:8px;justify-content:center;align-items:center;padding:12px;flex-wrap:wrap}
    .pager button{border:1px solid #e2e8f0;background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
    .pager .active{background:#0b3a6a;color:#fff;border-color:#0b3a6a}
    .pager .dots{padding:0 4px;color:#64748b}
    .status{font-size:12px;color:#64748b;padding:0 12px 8px}

    footer{text-align:center;padding:20px;background:#0b3a6a;color:#fff;margin-top:24px;font-size:14px;border-top:1px solid rgba(255,255,255,.15)}

    .snow{pointer-events:none;position:fixed;inset:0;overflow:hidden;z-index:1}
    .flake{position:absolute;top:-10px;width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.9);filter:blur(.5px);animation:fall linear infinite}
    @keyframes fall{0%{transform:translateY(-10px)}100%{transform:translateY(110vh)}}
    #toTop{position:fixed; right:12px; bottom:70px; z-index:60; display:none; background:#ffffff; color:#0b1220; border:1px solid #e2e8f0; border-radius:999px; padding:8px 12px; font-weight:800; box-shadow:0 8px 22px rgba(2,6,23,.22); cursor:pointer}
    #toTop.show{display:block}
    .section.partner h2 .plink{cursor:pointer;text-decoration:none;color:inherit}
    .section.partner h2 .plink:hover{opacity:.85}
    .tools-inline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .tools-inline input{padding:8px;border:1px solid #e2e8f0;border-radius:8px}
  </style>
</head>
<body>
  <div class="snow" aria-hidden="true"></div>

  <header class="hero">
    <span class="dev-badge">Folyamatos fejleszt√©s</span>
    <div class="hero-inner">
      <div class="brand">
        <img id="brandLogo" src="assets/img/findora-header.png" data-fallback1="assets/img/findora_mark.png" data-fallback2="https://upload.wikimedia.org/wikipedia/commons/3/3f/Compass_rose_simple.svg" alt="Findora log√≥" />
        <div>
          <h1>Findora</h1>
          <p>Ir√°nyt mutat a legjobb aj√°nlatokhoz</p>
        </div>
      </div>

      <div class="gift-row" aria-hidden="true">
        <div class="gift"><div class="bow"></div></div>
        <div class="gift" style="transform:translateZ(0) rotate(-4deg)"><div class="bow"></div></div>
        <div class="gift" style="transform:translateZ(0) rotate(2deg)"><div class="bow"></div></div>
        <div class="gift" style="transform:translateZ(0) rotate(-6deg)"><div class="bow"></div></div>
      </div>

      <div class="promo" role="note">üéÑ √únnepi hangulat, friss aj√°nlatokkal!</div>

      <div class="promo-banners" role="region" aria-label="Kiemelt akci√≥k">
        <a class="pb-card xmas" href="#deal10_24" aria-label="Merry Christmas akci√≥k">
          <div class="pb-left">
            <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2l2.4 4.8 5.3.8-3.9 3.8.9 5.3L12 14.9 7.3 16.7l.9-5.3L4.3 7.6l5.3-.8L12 2z" fill="currentColor"/></svg>
            <span class="pb-eyebrow">Merry</span>
            <span class="pb-title">Christmas</span>
          </div>
          <div class="pb-right"><span class="pb-cta">Aj√°nd√©k-√∂tletek ¬ª</span></div>
        </a>
        <a class="pb-card bf" href="#deal10_24" aria-label="Black Friday akci√≥k">
          <div class="pb-left">
            <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="7" width="18" height="12" rx="2" fill="currentColor"/><path d="M7 7V6a5 5 0 0 1 10 0v1" fill="none" stroke="currentColor" stroke-width="2"/></svg>
            <span class="pb-eyebrow">Black</span>
            <span class="pb-title">Friday</span>
          </div>
          <div class="pb-right">
            <span class="pb-count" id="bfCountdown">Bet√∂lt√©s‚Ä¶</span>
            <span class="pb-cta">Legjobb √°rak ¬ª</span>
          </div>
        </a>
      </div>
    </div>

    <div class="topbar-wrap">
      <div class="topbar">
        <nav class="categories" aria-label="Kateg√≥ri√°k">
          <button class="catbtn active" data-cat="all">√ñsszes</button>
          <button class="catbtn" data-cat="home">üè† Otthon</button>
          <button class="catbtn" data-cat="games">üïπÔ∏è J√°t√©kok</button>
          <button class="catbtn" data-cat="tech">üíª Tech</button>
          <button class="catbtn" data-cat="vision">üëì L√°t√°s</button>
          <button class="catbtn" data-cat="travel">‚úàÔ∏è Utaz√°s</button>
        </nav>

        <div class="disc-filter" aria-label="Kedvezm√©ny gyorssz≈±r≈ë">
          <button class="df-btn active" data-disc="0">Mind</button>
          <button class="df-btn" data-disc="25">‚àí25%+</button>
          <button class="df-btn" data-disc="50">‚àí50%+</button>
        </div>

        <form id="searchForm" class="searchbar" role="search" action="">
          <input id="q" name="q" type="search" placeholder="Mit keresel ma?" aria-label="Keres√©s" />
          <button type="submit" aria-label="Keres√©s ind√≠t√°sa">Keres√©s</button>
        </form>
      </div>
    </div>
  </header>

  <button class="floating-search" aria-label="Keres√©s megnyit√°sa" onclick="document.getElementById('q').focus()">üîç</button>
  <button id="toTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚ñ≤</button>

  <main>
    <div class="layout">
      <aside class="sidebar">
        <div class="side-block">
          <div class="side-title">Rendez√©s</div>
          <div class="chip-row" id="sortChips">
            <button class="chip active" data-sort="relevance">Alap (relevancia)</button>
            <button class="chip" data-sort="discount">Legnagyobb kedvezm√©ny</button>
            <button class="chip" data-sort="price_asc">Legalacsonyabb √°r</button>
            <button class="chip" data-sort="price_desc">Legmagasabb √°r</button>
            <button class="chip" data-sort="random">V√©letlen</button>
          </div>
          <div class="side-note">A rendez√©s a l√°that√≥ szekci√≥(k) k√°rty√°ira √©rv√©nyes.</div>
        </div>

        <div class="side-block">
          <div class="side-title">Gyorssz≈±r≈ëk</div>
          <div class="chip-row" id="quickFilters">
            <button class="chip" data-q="lego">LEGO</button>
            <button class="chip" data-q="tv">TV</button>
            <button class="chip" data-q="okos√≥ra">Okos√≥ra</button>
            <button class="chip" data-q="szem√ºveg">Szem√ºveg</button>
            <button class="chip" data-q="porsz√≠v√≥">Porsz√≠v√≥</button>
          </div>
        </div>

        <div class="side-block">
          <div class="side-title">Partnerek</div>
          <div class="chip-row">
            <a class="chip" href="#partner-tchibo">Tchibo.hu</a>
            <a class="chip" href="#partner-regio">RegioJ√°t√©k</a>
            <a class="chip" href="#partner-jateksziget">J√°t√©ksziget</a>
            <a class="chip" href="#partner-jateknet">J√°t√©kNet.hu</a>
            <a class="chip" href="#partner-karcher">K√§rcher.hu</a>
            <a class="chip" href="#partner-eoptika">eOptika.hu</a>
          </div>
        </div>
      </aside>

      <section id="content" style="min-height:400px;"></section>
    </div>
  </main>

  <footer>
    ¬© 2025 Findora ‚Ä¢ Az oldalon affiliate linkek lehetnek. Partnerek: Amazon, J√°t√©kNet.hu, K√§rcher.hu, eOptika.hu, Tchibo.hu, RegioJ√°t√©k, J√°t√©ksziget.
  </footer>

  <script>
  /* ====== Alap ====== */
  const PER_PAGE_GRID = 4;
  // >>> N√âLK√úLE √úRES A F≈êOLDAL:
  const content = document.getElementById('content');

  /* ====== API v√©gpontok ====== */
  const API_BASE = (location.hostname.endsWith('findora.hu'))
    ? 'https://www.findora.hu'
    : location.origin;
  const TCHIBO_API = `${API_BASE}/api/tchibo`;
  const REGIO_API = `${API_BASE}/api/regiojatek`;
  const JATEKSZIGET_API = `${API_BASE}/api/jateksziget`;

  /* ====== Statikus partner linkek ====== */
  const AMAZON_TAG = "findora30-20";
  const amazonBase = `https://www.amazon.com/?tag=${AMAZON_TAG}`;
  const LINK_EOPTIKA = "https://www.kqzyfj.com/tf79mu2-u1HJIJNPRIIQHJMIMRRJK";
  const LINK_JATEKNET= "https://www.anrdoezrs.net/2t70r09608OQPQUWYPPXOQTTTXPQQ";
  const LINK_KARCHER = "https://www.kqzyfj.com/pa117qgpmgo35459BD44C3587B77AD";

  const LOGO_URLS={
    Amazon:"https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg",
    "J√°t√©kNet.hu":"https://upload.wikimedia.org/wikipedia/commons/8/8f/Puzzle.svg",
    "K√§rcher.hu":"https://upload.wikimedia.org/wikipedia/commons/6/62/Karcher_logo.svg",
    "eOptika.hu":"https://upload.wikimedia.org/wikipedia/commons/7/72/Glasses_icon.svg",
    "Tchibo.hu":"https://upload.wikimedia.org/wikipedia/commons/0/0b/Tchibo_logo.svg",
    "RegioJ√°t√©k":"https://upload.wikimedia.org/wikipedia/commons/6/6a/Toy_Block.svg",
    "J√°t√©ksziget":"https://upload.wikimedia.org/wikipedia/commons/9/97/Teddy_bear_icon.svg"
  };

  (function(){ const img=document.getElementById('brandLogo'); let step=0; img.onerror=()=>{ step++; if(step===1) img.src=img.dataset.fallback1; else if(step===2) img.src=img.dataset.fallback2; }; })();

  /* ====== Placeholder/kulcsk√©pek ====== */
  const IMG_KEY={ lego:"https://images.unsplash.com/photo-1587300003388-59208cc962cb?w=1200&q=80&auto=format&fit=crop" };
  const PLACEHOLDER = 'data:image/svg+xml;utf8,'+encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'><defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#eee'/><stop offset='1' stop-color='#ddd'/></linearGradient></defs><rect fill='url(#g)' width='600' height='400'/><g fill='#999' font-family='Inter, Arial, Helvetica, sans-serif' font-size='22'><text x='50%' y='50%' text-anchor='middle'>K√©p el≈ëk√©sz√≠t√©s alatt‚Ä¶</text></g></svg>");
  function keyImage(title){ const t=String(title||"").toLowerCase(); for(const k of Object.keys(IMG_KEY)){ if(t.includes(k)) return IMG_KEY[k]; } return PLACEHOLDER; }

  /* ====== K√°rtya render ====== */
  function cardHTML(it){
    const primary = it.image ? it.image : keyImage(it.title);
    const imgTag =
      `<img class="imgsafe" alt="${it.title}"
            loading="lazy" decoding="async" referrerpolicy="no-referrer"
            data-src1="${primary}" data-src2="${PLACEHOLDER}" data-src3="${PLACEHOLDER}" />`;
    const logo = LOGO_URLS[it.partner] ? `<img src="${LOGO_URLS[it.partner]}" alt="${it.partner} log√≥" style="width:16px;height:16px;object-fit:contain">` : "";
    const desc = it.desc ? `<div class="desc">${it.desc}</div>` : "";
    return `
      <div class="card">
        <div class="thumb">${imgTag}</div>
        <div class="body">
          <div class="title">${it.title}</div>
          ${desc}
          <div class="muted">${logo} ${it.partner}${it.discount?` ‚Ä¢ ‚àí${it.discount}%`:''}</div>
          <div class="price">${it.price||""}</div>
        </div>
        <div class="cta"><a href="${it.url}" target="_blank" rel="nofollow sponsored noopener noreferrer">Megn√©zem az aj√°nlatot</a></div>
      </div>
    `;
  }
  function hydrateSafeImages(ctx=document){
    ctx.querySelectorAll("img.imgsafe").forEach(img=>{
      const chain=[img.dataset.src1, img.dataset.src2, img.dataset.src3].filter(Boolean);
      if (!chain.length) return;
      let i=0; const set=()=>{ img.src=chain[i]; };
      img.onerror=()=>{ i=Math.min(i+1,chain.length-1); if(img.src!==chain[i]) set(); };
      set();
    });
  }

  /* ====== √År seg√©d ====== */
  function computeDiscount(it){
    if (typeof it.discount === 'number' && it.discount>0) return it.discount;
    const p = Number.isFinite(it.priceNum) ? it.priceNum : null;
    const op = Number.isFinite(it.oldPriceNum) ? it.oldPriceNum : null;
    if (p!=null && op!=null && op>0 && p<op){
      return Math.max(0, Math.min(100, Math.round((1 - (p/op)) * 100)));
    }
    const m = (String(it.title||"").match(/-?\s*(\d{1,3})\s*%/));
    if (m) { const d=parseInt(m[1],10); return Number.isFinite(d)?d:0; }
    return 0;
  }

  /* ====== Cursor-feedek ====== */
  class CursorFeed {
    constructor(baseUrl, pageSize=50){
      this.baseUrl = baseUrl;
      this.pageSize = pageSize;
      this.items = [];
      this.nextCursor = null;
      this.loading = false;
      this.exhausted = false;
    }
    async loadMore(minDiscount=0, q=""){
      if (this.loading || this.exhausted) return;
      this.loading = true;
      try {
        const u = new URL(this.baseUrl);
        u.searchParams.set("page_size", this.pageSize);
        if (this.nextCursor) u.searchParams.set("cursor", this.nextCursor);
        if (minDiscount) u.searchParams.set("minDiscount", String(minDiscount));
        if (q) u.searchParams.set("q", q);
        const r = await fetch(u.toString(), { cache: "no-store" });
        if (!r.ok) throw new Error("API "+r.status);
        const d = await r.json(); // {items, nextCursor}
        const arr = Array.isArray(d.items)? d.items : [];
        arr.forEach(x=>{
          x.discount = computeDiscount(x);
          // ha van √°r sz√°mk√©nt, de a string hi√°nyzik, t√∂lts√ºk ki HU form√°tumban
          if (!x.price && Number.isFinite(x.priceNum)) {
            x.price = new Intl.NumberFormat('hu-HU').format(x.priceNum) + ' Ft';
          }
          // ha nincs priceNum, de a price sz√∂vegb≈ël kiolvashat√≥ sz√°m, ments√ºk
          if (!Number.isFinite(x.priceNum) && x.price) {
            const digits = String(x.price).replace(/[^\d]/g,''); const n = Number(digits);
            if (Number.isFinite(n)) {
              x.priceNum = n;
              if (!x.price) x.price = new Intl.NumberFormat('hu-HU').format(n) + ' Ft';
            }
          }
        });
        this.items.push(...arr);
        this.nextCursor = d.nextCursor || null;
        this.exhausted = !this.nextCursor;
      } finally {
        this.loading = false;
      }
    }
    async ensure(count, opts={}) {
      while (this.items.length < count && !this.exhausted) {
        await this.loadMore(opts.minDiscount||0, opts.q||"");
      }
      return this.items.slice(0, count);
    }
  }

  // √ñsszetett feed: t√∂bb partnerb≈ël kombin√°l, round-robin t√∂lt√©s
  class CombinedFeed {
    constructor(feeds){
      this.feeds = feeds; // {name, feed}
      this.pool = [];     // √∂sszes eddig bet√∂lt√∂tt elem
      this.ptrs = new Map(feeds.map(f=>[f.name,0]));
      this.loading = false;
    }
    // felt√©tel: pl. kedvezm√©ny-tartom√°ny
    filterFn(it){ return true; }
    setFilter(fn){ this.filterFn = fn || (x=>true); }
    async ensure(n, opts={}){
      const filtered = () => this.pool.filter(this.filterFn);
      // ha m√°r el√©g van, visszaadjuk
      if (filtered().length >= n) return filtered().slice(0,n);

      // round-robin: mindig a legr√∂videbb feedb≈ël k√©r√ºnk m√©g
      let watchdog = 0;
      while (filtered().length < n) {
        watchdog++; if (watchdog>200) break;
        // v√°lassz feedet, amelyikn√©l m√©g van potenci√°l
        let picked = null;
        for (const f of this.feeds) {
          if (!f.feed.exhausted) { picked = f; break; }
        }
        if (!picked) break;
        await picked.feed.loadMore(opts.minDiscount||0, opts.q||"");
        // √∫j elemeket beemelni a poolba
        const fresh = picked.feed.items.slice(this.ptrs.get(picked.name));
        this.ptrs.set(picked.name, picked.feed.items.length);
        this.pool.push(...fresh);
      }
      return filtered().slice(0, n);
    }
  }

  // Singleton feedek
  const FEEDS = {
    tchibo:      new CursorFeed(TCHIBO_API, 50),
    regio:       new CursorFeed(REGIO_API, 50),
    jateksziget: new CursorFeed(JATEKSZIGET_API, 50)
  };

  /* ====== Rendez√©s ====== */
  let currentSort = 'relevance';
  function applySort(arr){
    const a = arr.slice();
    if (currentSort === 'discount')      a.sort((x,y)=>(y.discount||0)-(x.discount||0));
    else if (currentSort === 'price_asc') a.sort((x,y)=>(x.priceNum??Infinity)-(y.priceNum??Infinity));
    else if (currentSort === 'price_desc')a.sort((x,y)=>(y.priceNum??-1)-(x.priceNum??-1));
    else if (currentSort === 'random')    for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
    return a;
  }

  /* ====== Pager HTML ====== */
  function progressivePagerHTML(knownCount, page, per, hasMore){
    // ha hasMore igaz, nem mutatjuk a ‚Äûv√©g√©t‚Äù, csak k√∂vetkez≈ë/el≈ëz≈ë + n√©h√°ny sz√°m
    const totalPagesKnown = Math.ceil(knownCount / per) || 1;
    const btn = (p, act=false, dis=false, label=null)=>`<button data-page="${p}" ${dis?'disabled':''} class="${act?'active':''}">${label||p}</button>`;
    let html = `<div class="pager">`;
    html += btn(Math.max(1,page-1), false, page<=1, '¬´');
    const windowRadius = 2;
    const first = 1, last = hasMore ? Math.max(first, page+windowRadius) : totalPagesKnown;
    const left = Math.max(first+1, page - windowRadius);
    const right = Math.min(last-1, page + windowRadius);
    html += btn(first, page===first);
    if (left > first+1) html += `<span class="dots">‚Ä¶</span>`;
    for (let p = left; p <= right; p++) html += btn(p, p===page);
    if (!hasMore && right < last-1) html += `<span class="dots">‚Ä¶</span>`;
    if (!hasMore && last>first) html += btn(last, page===last);
    html += btn(page+1, false, hasMore?false:(page>=totalPagesKnown), '¬ª');
    html += `</div>`;
    return html;
  }

  /* ====== UI √°llapot ====== */
  let currentCategory = "all";
  window.minDiscountFilter = 0;

  document.addEventListener('click', (e)=>{
    const b = e.target.closest('.df-btn');
    if(b){
      document.querySelectorAll('.df-btn').forEach(x=>x.classList.toggle('active', x===b));
      window.minDiscountFilter = Number(b.dataset.disc||0);
      showCategory(currentCategory||"all");
    }
    const sc = e.target.closest('#sortChips .chip');
    if(sc){
      document.querySelectorAll('#sortChips .chip').forEach(x=>x.classList.toggle('active', x===sc));
      currentSort = sc.dataset.sort || 'relevance';
      showCategory(currentCategory||"all");
    }
    const qf = e.target.closest('#quickFilters .chip');
    if(qf){
      const term = qf.dataset.q || '';
      if(term){ document.getElementById('q').value = term; showSearch(term); }
    }
  });

  /* ====== Szekci√≥ render cursor-t√°mogat√°ssal (4/lap) ====== */
  function renderCursorSection({title, partnerName, feed, anchorId, festive=false, q=""}){
    const sec=document.createElement('section');
    sec.className='section partner'+(festive?' festive':'');
    if (anchorId) sec.id = anchorId;

    sec.innerHTML=`<h2><span class="plink" data-partner-open="${partnerName}">${partnerName}</span> <small style="font-weight:600;color:#475569">‚Äì ${title}</small></h2><div class="status"></div><div class="grid"></div><div class="pager"></div>`;
    const grid=sec.querySelector('.grid');
    const status=sec.querySelector('.status');
    const pager=sec.querySelector('.pager');

    const per = PER_PAGE_GRID;
    let page = 1;
    let hasMore = true;
    let known = 0;

    async function draw(){
      // biztos√≠tsuk, hogy legyen el√©g elem a k√©rt oldalig
      const need = page*per;
      await feed.ensure(need, {minDiscount: window.minDiscountFilter||0, q});
      const slice = applySort(feed.items.filter(i => (i.discount||0) >= (window.minDiscountFilter||0)));
      known = slice.length;
      hasMore = !feed.exhausted; // ha nincs kimer√ºlve, lehet t√∂bb is
      const pagesNow = Math.max(1, Math.ceil(Math.max(known, (hasMore? page*per : known)) / per));
      if (page>pagesNow) page = pagesNow;

      const st = (page-1)*per;
      const show = slice.slice(st, st+per);

      grid.innerHTML = '';
      show.forEach(it=>grid.insertAdjacentHTML('beforeend', cardHTML(it)));
      hydrateSafeImages(sec);

      pager.innerHTML = progressivePagerHTML(known, page, per, hasMore);
      const df = (window.minDiscountFilter||0);
      status.textContent = `${known}${hasMore?' +':''} tal√°lat ‚Ä¢ ${per}/oldal${df?` ‚Ä¢ Sz≈±r√©s: ‚àí${df}%+`:''}${currentSort!=='relevance'?` ‚Ä¢ Rendez√©s: ${document.querySelector('#sortChips .chip.active')?.textContent||''}`:''}`;
    }

    sec.addEventListener('click', async (e)=>{
      const b = e.target.closest('.pager button');
      if(b){ page = Math.max(1, parseInt(b.dataset.page,10)||1); await draw(); /* NEM G√ñRGET√úNK FEL */ }
      const h = e.target.closest('[data-partner-open]');
      if(h){ openPartnerView(partnerName, feed); }
    });

    (async ()=>{ await draw(); })();

    content.appendChild(sec);
  }

  /* ====== Kombin√°lt (√ñsszes partner) szekci√≥ a 10‚Äì24 / 25‚Äì49 / 50%+ buckettekhez ====== */
  async function renderCombinedBuckets(){
    const combined = new CombinedFeed([
      {name:'tchibo', feed:FEEDS.tchibo},
      {name:'regio', feed:FEEDS.regio},
      {name:'jateksziget', feed:FEEDS.jateksziget},
    ]);

    // 10‚Äì24%
    const s1=document.createElement('section'); s1.className='section festive'; s1.id="deal10_24";
    s1.innerHTML=`<h2>√ñsszes partner ‚Äì üéØ ‚àí10‚Äì24% akci√≥k</h2><div class="status"></div><div class="grid"></div><div class="pager"></div>`;
    content.appendChild(s1);

    // 25‚Äì49%
    const s2=document.createElement('section'); s2.className='section festive'; s2.id="deal25_49";
    s2.innerHTML=`<h2>√ñsszes partner ‚Äì üî• ‚àí25‚Äì49% akci√≥k</h2><div class="status"></div><div class="grid"></div><div class="pager"></div>`;
    content.appendChild(s2);

    // 50%+
    const s3=document.createElement('section'); s3.className='section festive'; s3.id="deal50plus";
    s3.innerHTML=`<h2>√ñsszes partner ‚Äì üí• ‚àí50%+</h2><div class="status"></div><div class="grid"></div><div class="pager"></div>`;
    content.appendChild(s3);

    const setups = [
      {node:s1, min:10, max:24},
      {node:s2, min:25, max:49},
      {node:s3, min:50, max:1000}
    ];

    for (const st of setups){
      let page=1, per=PER_PAGE_GRID, known=0, hasMore=true;

      const draw = async ()=>{
        combined.setFilter(it=>{
          const d = computeDiscount(it);
          return d>=st.min && d<=st.max && (it.discount = d, true);
        });

        // a k√©rt oldal kijelz√©s√©hez biztos√≠tsunk elegend≈ë anyagot
        const need = page*per;
        await combined.ensure(need, {minDiscount:0, q:""}); // kombin√°lt, nincs extra query

        // sz≈±rt + rendezett
        const arr = applySort(combined.pool.filter(combined.filterFn));
        known = arr.length;
        hasMore = combined.feeds.some(f=>!f.feed.exhausted);

        const stIdx=(page-1)*per;
        const show = arr.slice(stIdx, stIdx+per);

        const grid=st.node.querySelector('.grid');
        grid.innerHTML=''; show.forEach(it=>grid.insertAdjacentHTML('beforeend', cardHTML(it)));
        hydrateSafeImages(st.node);

        const pager=st.node.querySelector('.pager');
        pager.innerHTML = progressivePagerHTML(known, page, per, hasMore);
        const status=st.node.querySelector('.status');
        status.textContent = `${known}${hasMore?' +':''} tal√°lat ‚Ä¢ ${per}/oldal${currentSort!=='relevance'?` ‚Ä¢ Rendez√©s: ${document.querySelector('#sortChips .chip.active')?.textContent||''}`:''}`;
      };

      st.node.addEventListener('click', async (e)=>{
        const b = e.target.closest('.pager button');
        if(b){ page = Math.max(1, parseInt(b.dataset.page,10)||1); await draw(); }
      });

      await draw();
    }
  }

  /* ====== F≈ëoldal ====== */
  async function renderHomeAll(){
    content.innerHTML="";

    await Promise.all([
      FEEDS.tchibo.ensure(12, {minDiscount:window.minDiscountFilter||0}),
      FEEDS.regio.ensure(12, {minDiscount:window.minDiscountFilter||0}),
      FEEDS.jateksziget.ensure(12, {minDiscount:window.minDiscountFilter||0}),
    ]);

    await renderCombinedBuckets();

    renderCursorSection({title:"Otthon",  partnerName:"Tchibo.hu",    feed:FEEDS.tchibo,      anchorId:"partner-tchibo"});
    renderCursorSection({title:"J√°t√©kok", partnerName:"RegioJ√°t√©k",   feed:FEEDS.regio,       anchorId:"partner-regio"});
    renderCursorSection({title:"J√°t√©kok", partnerName:"J√°t√©ksziget",  feed:FEEDS.jateksziget, anchorId:"partner-jateksziget"});

    // Statikus partnerek 4/lap fix
    renderStaticSection("J√°t√©kok","J√°t√©kNet.hu", JATEKNET_ITEMS, "partner-jateknet");
    renderStaticSection("Otthon","K√§rcher.hu", KARCHER_ITEMS, "partner-karcher");
    renderStaticSection("L√°t√°s","eOptika.hu", EOPTIKA_ITEMS, "partner-eoptika");
    renderStaticSection("Tech","Amazon", ITEMS);
  }

  /* ====== Statikus szekci√≥ helper ====== */
  const ITEMS=[
    {title:"Olcs√≥ laptop", partner:"Amazon", price:"129 990 Ft", discount:25, url:amazonBase, category:"tech", desc:"Bel√©p≈ë modellek gyors sz√°ll√≠t√°ssal."},
    {title:"Gaming laptop", partner:"Amazon", price:"299 990 Ft", discount:35, url:amazonBase, category:"tech", desc:"RTX/AMD grafika, nagy k√©pfriss√≠t√©s."},
    {title:"Vezet√©k n√©lk√ºli f√ºlhallgat√≥", partner:"Amazon", price:"17 990 Ft", discount:28, url:amazonBase, category:"tech"},
    {title:"Smart TV -55%", partner:"Amazon", price:"119 990 Ft", discount:55, url:amazonBase, category:"tech"}
  ];
  const EOPTIKA_ITEMS = [
    {title:"Divatos szem√ºvegkeret", partner:"eOptika.hu", price:"", discount:0, url:LINK_EOPTIKA, category:"vision", desc:"Klasszikus form√°k, pr√©mium anyagok."},
    {title:"Polariz√°lt napszem√ºveg", partner:"eOptika.hu", price:"", discount:0, url:LINK_EOPTIKA, category:"vision", desc:"UV400 v√©delem, t√∂bb sz√≠nben."},
    {title:"Napi kontaktlencse csomag", partner:"eOptika.hu", price:"", discount:0, url:LINK_EOPTIKA, category:"vision", desc:"K√©nyelmes, higi√©nikus megold√°s."},
    {title:"K√©kf√©ny-sz≈±r≈ës szem√ºveg", partner:"eOptika.hu", price:"", discount:0, url:LINK_EOPTIKA, category:"vision", desc:"Sz√°m√≠t√≥g√©pez√©shez ide√°lis."}
  ];
  const JATEKNET_ITEMS = [
    {title:"LEGO kreat√≠v k√©szlet", partner:"J√°t√©kNet.hu", price:"", discount:0, url:LINK_JATEKNET, category:"games", desc:"√âp√≠tsd meg, amit csak elk√©pzelsz."},
    {title:"Csal√°di t√°rsasj√°t√©k", partner:"J√°t√©kNet.hu", price:"", discount:0, url:LINK_JATEKNET, category:"games", desc:"Garant√°lt k√∂z√∂s √©lm√©nyek."},
    {title:"J√°t√©kkonzol kontrollerek", partner:"J√°t√©kNet.hu", price:"", discount:0, url:LINK_JATEKNET, category:"games", desc:"Extra ir√°ny√≠t√≥k t√∂bbj√°t√©kos m√≥k√°hoz."},
    {title:"Kreat√≠v rajzk√©szlet", partner:"J√°t√©kNet.hu", price:"", discount:0, url:LINK_JATEKNET, category:"games", desc:"Fejleszti a fant√°zi√°t √©s √ºgyess√©get."}
  ];
  const KARCHER_ITEMS = [
    {title:"Magasnyom√°s√∫ mos√≥", partner:"K√§rcher.hu", price:"", discount:0, url:LINK_KARCHER, category:"home", desc:"Teraszok, aut√≥ gyors tiszt√≠t√°sa."},
    {title:"G≈ëztiszt√≠t√≥", partner:"K√§rcher.hu", price:"", discount:0, url:LINK_KARCHER, category:"home", desc:"Vegyszermentes, higi√©nikus tiszt√≠t√°s."},
    {title:"Porsz√≠v√≥ kieg√©sz√≠t≈ëk", partner:"K√§rcher.hu", price:"", discount:0, url:LINK_KARCHER, category:"home", desc:"Sz≈±r≈ëk, zs√°kok, tartoz√©kok."},
    {title:"Ablaktiszt√≠t√≥", partner:"K√§rcher.hu", price:"", discount:0, url:LINK_KARCHER, category:"home", desc:"Cs√≠kmentes, gyors ablaktiszt√≠t√°s."}
  ];

  function renderStaticSection(title, partnerName, items, anchorId){
    const sec=document.createElement('section');
    sec.className='section partner';
    if (anchorId) sec.id = anchorId;

    const filtered = items.map(x=>({ ...x, priceNum: null, oldPriceNum:null }));
    sec.innerHTML=`<h2>${partnerName} <small style="font-weight:600;color:#475569">‚Äì ${title}</small></h2><div class="status"></div><div class="grid"></div>`;
    const grid=sec.querySelector('.grid');
    filtered.slice(0, PER_PAGE_GRID).forEach(it=>grid.insertAdjacentHTML('beforeend', cardHTML(it)));
    hydrateSafeImages(sec);
    const status=sec.querySelector('.status'); status.textContent = `${filtered.length} aj√°nlatb√≥l v√°logat√°s ‚Ä¢ ${PER_PAGE_GRID}/oldal`;
    content.appendChild(sec);
  }

  /* ====== Kateg√≥ria-n√©zetek ====== */
  async function showCategory(cat){
    currentCategory = cat;
    document.querySelectorAll(".catbtn").forEach(b=>{
      b.classList.toggle("active", b.dataset.cat===cat || (cat==="all" && b.dataset.cat==="all"));
    });
    if(cat==="all"){ await renderHomeAll(); return; }

    content.innerHTML="";
    if(cat==="home"){
      renderCursorSection({title:"Otthon", partnerName:"K√§rcher.hu", feed:{items:KARCHER_ITEMS, ensure:async()=>KARCHER_ITEMS}, anchorId:"partner-karcher"});
      renderCursorSection({title:"Otthon", partnerName:"Tchibo.hu",  feed:FEEDS.tchibo, anchorId:"partner-tchibo"});
      return;
    }
    if(cat==="games"){
      renderCursorSection({title:"J√°t√©kok", partnerName:"RegioJ√°t√©k",  feed:FEEDS.regio, anchorId:"partner-regio"});
      renderCursorSection({title:"J√°t√©kok", partnerName:"J√°t√©ksziget", feed:FEEDS.jateksziget, anchorId:"partner-jateksziget"});
      renderStaticSection("J√°t√©kok","J√°t√©kNet.hu", JATEKNET_ITEMS, "partner-jateknet");
      return;
    }
    if(cat==="tech"){ renderStaticSection("Tech", "Amazon", ITEMS); return; }
    if(cat==="vision"){ renderStaticSection("L√°t√°s", "eOptika.hu", EOPTIKA_ITEMS, "partner-eoptika"); return; }
    if(cat==="travel"){
      const s=document.createElement('section');
      s.className='section'; s.innerHTML=`<h2>‚úàÔ∏è Utaz√°s</h2><div style="padding:12px">Hamarosan...</div>`;
      content.appendChild(s); return;
    }
  }
  document.querySelectorAll(".catbtn").forEach(btn=>btn.addEventListener("click",()=>showCategory(btn.dataset.cat)));

  /* ====== Keres≈ë ====== */
  async function showSearch(val){
    const v=val.toLowerCase();
    content.innerHTML= `
      <section class="section">
        <div class="toolbar">
          <div class="group">
            <button class="toolbtn" id="btnBack">‚Üê Vissza</button>
            <strong>Keres√©s: ‚Äû${val}‚Äù</strong>
          </div>
          <div class="group">
            <button class="toolbtn" id="btnHome">üè† F≈ëoldal</button>
          </div>
        </div>
      </section>`;
    document.getElementById('btnBack').onclick=()=>showCategory("all");
    document.getElementById('btnHome').onclick=()=>showCategory("all");

    // kombin√°lt feed a keres√©shez: a h√°rom partnerb≈ël
    const comb = new CombinedFeed([
      {name:'tchibo', feed:FEEDS.tchibo},
      {name:'regio', feed:FEEDS.regio},
      {name:'jateksziget', feed:FEEDS.jateksziget},
    ]);
    comb.setFilter(it=>{
      const dfOk = (it.discount||0) >= (window.minDiscountFilter||0);
      const txt = (String(it.title).toLowerCase()+" "+String(it.desc||"").toLowerCase());
      return dfOk && txt.includes(v);
    });

    // szekci√≥, ami a comb feedb≈ël lapoz 4/lap
    const s=document.createElement('section');
    s.className='section partner';
    s.innerHTML=`<h2>√ñsszes partner ‚Äì Keres√©si tal√°latok</h2><div class="status"></div><div class="grid"></div><div class="pager"></div>`;
    content.appendChild(s);

    const grid=s.querySelector('.grid'); const pager=s.querySelector('.pager'); const status=s.querySelector('.status');
    let page=1, per=PER_PAGE_GRID, known=0, hasMore=true;

    async function draw(){
      const need = page*per;
      await comb.ensure(need, {minDiscount:window.minDiscountFilter||0, q: v});
      const arr = applySort(comb.pool.filter(comb.filterFn));
      known = arr.length;
      hasMore = comb.feeds.some(f=>!f.feed.exhausted);

      const st=(page-1)*per; const show=arr.slice(st, st+per);
      grid.innerHTML=''; show.forEach(it=>grid.insertAdjacentHTML('beforeend', cardHTML(it)));
      hydrateSafeImages(s);
      pager.innerHTML = progressivePagerHTML(known, page, per, hasMore);
      const df = (window.minDiscountFilter||0);
      status.textContent = `${known}${hasMore?' +':''} tal√°lat ‚Ä¢ ${per}/oldal${df?` ‚Ä¢ Sz≈±r√©s: ‚àí${df}%+`:''}${currentSort!=='relevance'?` ‚Ä¢ Rendez√©s: ${document.querySelector('#sortChips .chip.active')?.textContent||''}`:''}`;
    }
    s.addEventListener('click', async (e)=>{ const b=e.target.closest('.pager button'); if(b){ page=Math.max(1,parseInt(b.dataset.page,10)||1); await draw(); } });
    await draw();
  }
  document.getElementById('searchForm').addEventListener('submit',e=>{
    e.preventDefault();
    const val=document.getElementById('q').value.trim();
    if(val) showSearch(val); else showCategory("all");
  });

  /* ====== H√≥ + toTop + Prom√≥ ====== */
  (function snow(){
    const wrap=document.querySelector('.snow');
    const isMobile = matchMedia('(max-width: 640px)').matches;
    const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
    const COUNT = prefersReduced ? 0 : (isMobile ? 14 : 28);
    for(let i=0;i<COUNT;i++){
      const f=document.createElement('div');
      f.className='flake';
      f.style.left = Math.random()*100 + 'vw';
      const dur = (isMobile ? 10 : 8) + Math.random()*10;
      f.style.animationDuration = dur + 's';
      f.style.animationDelay = (Math.random()*-dur) + 's';
      f.style.opacity = (0.45 + Math.random()*0.35).toFixed(2);
      const size = (isMobile ? 1.5 : 2) + Math.random()*4;
      f.style.width = f.style.height = size + 'px';
      wrap.appendChild(f);
    }
  })();
  (function(){ const btn = document.getElementById('toTop'); window.addEventListener('scroll', ()=>{ if (window.scrollY > 600) btn.classList.add('show'); else btn.classList.remove('show'); }); })();

  (function promoLogicTZ(){
    const now = new Date();
    const y = now.getFullYear();
    function lastFridayOfNovember(year){
      const d = new Date(year, 10, 30);
      while(d.getDay() !== 5){ d.setDate(d.getDate()-1); }
      d.setHours(0,0,0,0);
      return d;
    }
    const bfDate = lastFridayOfNovember(y);
    const el = document.getElementById('bfCountdown');
    if(el){
      const pad = n => String(n).padStart(2,'0');
      function tick(){
        const now = new Date();
        const diff = bfDate - now;
        if(diff <= 0){ el.textContent = "Ma!"; return; }
        const d = Math.floor(diff/86400000);
        const h = Math.floor((diff%86400000)/3600000);
        const m = Math.floor((diff%3600000)/60000);
        el.textContent = `${pad(d)} nap ${pad(h)}:${pad(m)}`;
        requestAnimationFrame(()=>setTimeout(tick, 20000));
      }
      tick();
    }
  })();

  /* ====== Partner teljes lista (k√ºl√∂n teljes n√©zet) ====== */
  function openPartnerView(name, feed) {
    const sec = document.createElement('section');
    sec.className = 'section';
    sec.innerHTML = `
      <div class="toolbar">
        <div class="group">
          <button class="toolbtn" id="pvBack">‚Üê Vissza</button>
          <strong>${name} ‚Äì Teljes lista</strong>
        </div>
        <div class="group">
          <button class="toolbtn" id="pvHome">üè† F≈ëoldal</button>
        </div>
      </div>
      <div class="status"></div>
      <div class="grid"></div>
      <div class="pager"></div>
    `;
    const grid=sec.querySelector('.grid');
    const status=sec.querySelector('.status');
    const pager=sec.querySelector('.pager');

    const per = 20; // teljes n√©zetben 20/lap
    let page = 1, known=0, hasMore=true;

    async function draw(){
      const need = page*per;
      await feed.ensure(need, {minDiscount: window.minDiscountFilter||0});
      const arr = applySort(feed.items.filter(i => (i.discount||0) >= (window.minDiscountFilter||0)));
      known = arr.length;
      hasMore = !feed.exhausted;

      const st=(page-1)*per; const show=arr.slice(st, st+per);
      grid.innerHTML=''; show.forEach(it=>grid.insertAdjacentHTML('beforeend', cardHTML(it)));
      hydrateSafeImages(sec);
      pager.innerHTML = progressivePagerHTML(known, page, per, hasMore);
      const df=(window.minDiscountFilter||0);
      status.textContent = `${known}${hasMore?' +':''} tal√°lat ‚Ä¢ ${per}/oldal${df?` ‚Ä¢ Sz≈±r√©s: ‚àí${df}%+`:''}${currentSort!=='relevance'?` ‚Ä¢ Rendez√©s: ${document.querySelector('#sortChips .chip.active')?.textContent||''}`:''}`;
    }

    sec.addEventListener('click', async (e)=>{
      if (e.target.id === 'pvBack') showCategory(currentCategory||'all');
      if (e.target.id === 'pvHome') showCategory('all');
      const b=e.target.closest('.pager button'); if(b){ page=Math.max(1,parseInt(b.dataset.page,10)||1); await draw(); }
    });

    content.innerHTML = '';
    content.appendChild(sec);
    (async ()=>{ await draw(); })();
  }

  /* ====== Ind√≠t√°s ====== */
  (async function init(){
    const urlQ=new URLSearchParams(location.search).get('q');
    if(urlQ){
      document.getElementById('q').value=urlQ;
      await showSearch(urlQ);
    } else {
      await showCategory("all");
    }
  })();
  </script>
</body>
</html>
