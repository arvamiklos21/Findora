<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz</title>
  <meta name="description" content="A Findora seg√≠t megtal√°lni a legjobb akci√≥kat √©s aj√°nlatokat." />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <style>
    :root{--brand:#0077FF;--brand2:#00BBFF;--bg:#f7f9fc;--text:#0f172a;--muted:#64748b;--border:#e2e8f0}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{background:#fff;border-bottom:1px solid var(--border);text-align:center;padding:20px 10px}
    main{max-width:1200px;margin:18px auto;padding:0 12px}
    h1{font-size:24px;font-weight:800}
    h2{font-size:18px;margin:10px 0 0}
    .grid{display:flex;flex-wrap:wrap;gap:12px;padding:12px;justify-content:center}
    .card{background:#fff;border:1px solid var(--border);border-radius:12px;overflow:hidden;display:flex;flex-direction:column;width:240px}
    .thumb{height:150px;background:#f1f5f9;display:flex;align-items:center;justify-content:center}
    .thumb img{max-width:100%;max-height:100%}
    .title{font-weight:700;font-size:14px;margin:8px;text-align:center}
    .desc{font-size:12px;color:#64748b;margin:0 8px 8px;text-align:center}
    .muted{font-size:12px;color:#94a3b8;text-align:center}
    .price{font-weight:900;text-align:center;margin:6px 0}
    .cta{display:inline-block;background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;text-decoration:none;padding:6px 12px;border-radius:8px;font-weight:700;margin:10px auto}
    .chip{border:1px solid var(--border);background:#fff;border-radius:999px;padding:6px 10px;font-weight:700}
    .nav{display:flex;gap:8px;justify-content:center}
    .note{color:#64748b;text-align:center;margin:6px 0}
    footer{margin:20px 0 30px;text-align:center;color:#64748b;font-size:13px}
    a#tchibo-head-link{text-decoration:underline;font-weight:900}
  </style>
</head>
<body>
  <header>
    <h1>Findora</h1>
    <p class="note">Ir√°nyt mutat a legjobb aj√°nlatokhoz ‚Ä¢ Tchibo statikus feedb≈ël gyorsan t√∂lt</p>
  </header>

  <main>
    <section id="otthon">
      <h2>Otthon ‚Äì <a href="#tchibo-full" id="tchibo-head-link">Tchibo</a> aj√°nlatok</h2>

      <!-- √Åttekint≈ë (6/lap) -->
      <div class="grid" id="tchibo-overview-list">
        <div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div>
      </div>
      <div id="tchibo-overview-nav" class="nav"></div>

      <!-- Teljes n√©zet (20/lap) ‚Äì alapb√≥l rejtve -->
      <div class="grid" id="tchibo-full-list" style="display:none"></div>
      <div id="tchibo-full-nav" class="nav" style="display:none"></div>
    </section>

    <p class="note">Az oldalon affiliate linkek lehetnek (Dognet).</p>
  </main>

  <footer>¬© 2025 Findora</footer>

  <script defer>
  (function(){
    // ---- alap konstansok ----
    const API_BASE = location.hostname.endsWith('findora.hu') ? 'https://www.findora.hu' : location.origin;
    const tchiboDl = u => `${API_BASE}/api/dl?u=${encodeURIComponent(u)}&p=tchibo`;
    const META_URL = '/feeds/tchibo/meta.json';
    const PAGE_URL = n => `/feeds/tchibo/page-${String(n).padStart(4,'0')}.json`;

    // ---- guard: ha nincs fetch, √°lljunk meg sz√©pen ----
    if (!window.fetch) {
      document.getElementById('tchibo-overview-list').innerHTML =
        '<div class="card"><div class="thumb">‚ùó</div><div class="title">A b√∂ng√©sz≈ë t√∫l r√©gi a bet√∂lt√©shez.</div></div>';
      return;
    }

    let META = null; const CACHE = new Map();

    async function getMeta(){
      if (META) return META;
      const r = await fetch(META_URL, {cache:'no-cache'});
      if (!r.ok) throw new Error('meta.json nem el√©rhet≈ë');
      META = await r.json();
      return META;
    }
    async function getPage(n){
      const key = `page-${String(n).padStart(4,'0')}`;
      if (CACHE.has(key)) return CACHE.get(key);
      const r = await fetch(PAGE_URL(n), {cache:'no-cache'});
      if (!r.ok) throw new Error(`page ${key} nem el√©rhet≈ë`);
      const d = await r.json();
      CACHE.set(key, d);
      return d;
    }

    async function fetchItems(offset, limit){
      const meta = await getMeta();
      const srcPageSize = meta.pageSize || 300;
      const total = meta.total ?? (meta.pages * srcPageSize);
      const out = []; let i = offset;
      while (out.length < limit && i < total){
        const pageNum = Math.floor(i / srcPageSize) + 1;
        const innerIdx = i % srcPageSize;
        const page = await getPage(pageNum);
        const arr = (page && page.items) ? page.items : [];
        if (innerIdx < arr.length) out.push(arr[innerIdx]);
        i++; if (arr.length === 0) break;
      }
      return out;
    }

    function fmtPrice(p){ return Number.isFinite(p) ? (p.toLocaleString('hu-HU') + ' Ft') : ''; }

    function renderCards(root, items){
      root.innerHTML = (items||[]).map(it => {
        const img = it && it.img ? `<img src="${it.img}" alt="">` : 'üõçÔ∏è';
        const title = (it && it.title) ? it.title : '';
        const desc = (it && it.desc) ? `<div class="desc">${it.desc}</div>` : '';
        const disc = (it && Number.isFinite(it.discount)) ? ` ‚Ä¢ ‚àí${it.discount}%` : '';
        const price = (it && (Number.isFinite(it.price) || it.price)) ? `<div class="price">${fmtPrice(it.price)||it.price}</div>` : '';
        const cta = (it && it.url) ? `<a class="cta" target="_blank" rel="nofollow sponsored noopener noreferrer" href="${tchiboDl(it.url)}">Megn√©zem</a>` : '';
        return `
          <div class="card">
            <div class="thumb">${img}</div>
            <div class="title">${title}</div>
            ${desc}
            <div class="muted">Tchibo${disc}</div>
            ${price}
            ${cta}
          </div>
        `;
      }).join('') || '<div class="card"><div class="thumb">üôÉ</div><div class="title">Nincs megjelen√≠thet≈ë term√©k.</div></div>';
    }

    // ----- 6/lap √°ttekint≈ë -----
    const OVERVIEW_SIZE = 6; let overviewPage = 1;
    async function loadOverview(page=1){
      try{
        const meta = await getMeta();
        const total = meta.total ?? (meta.pages * (meta.pageSize||300));
        const offset = (page-1)*OVERVIEW_SIZE;
        const items = await fetchItems(offset, OVERVIEW_SIZE);
        renderCards(document.getElementById('tchibo-overview-list'), items);
        const totalPages = Math.max(1, Math.ceil(total / OVERVIEW_SIZE));
        document.getElementById('tchibo-overview-nav').innerHTML = `
          <button class="chip" ${page<=1?'disabled':''} onclick="window.__tch_ov(${page-1})">El≈ëz≈ë</button>
          <span class="chip">${page}/${totalPages}</span>
          <button class="chip" ${page>=totalPages?'disabled':''} onclick="window.__tch_ov(${page+1})">K√∂vetkez≈ë</button>`;
        overviewPage = page;
      }catch(e){
        console.error(e);
        document.getElementById('tchibo-overview-list').innerHTML =
          '<div class="card"><div class="thumb">‚ö†Ô∏è</div><div class="title">Nem siker√ºlt bet√∂lteni (overview).</div></div>';
      }
    }
    window.__tch_ov = (n)=>loadOverview(n);

    // ----- 20/lap teljes -----
    const FULL_SIZE = 20; let fullPage = 1;
    async function loadFull(page=1){
      try{
        const meta = await getMeta();
        const total = meta.total ?? (meta.pages * (meta.pageSize||300));
        const offset = (page-1)*FULL_SIZE;
        const items = await fetchItems(offset, FULL_SIZE);
        renderCards(document.getElementById('tchibo-full-list'), items);
        const totalPages = Math.max(1, Math.ceil(total / FULL_SIZE));
        document.getElementById('tchibo-full-nav').innerHTML = `
          <button class="chip" ${page<=1?'disabled':''} onclick="window.__tch_full(${page-1})">El≈ëz≈ë</button>
          <span class="chip">${page}/${totalPages}</span>
          <button class="chip" ${page>=totalPages?'disabled':''} onclick="window.__tch_full(${page+1})">K√∂vetkez≈ë</button>`;
        fullPage = page;
      }catch(e){
        console.error(e);
        document.getElementById('tchibo-full-list').innerHTML =
          '<div class="card"><div class="thumb">‚ö†Ô∏è</div><div class="title">Nem siker√ºlt bet√∂lteni (full).</div></div>';
      }
    }
    window.__tch_full = (n)=>loadFull(n);

    function showOverview(){
      document.getElementById('tchibo-overview-list').style.display='';
      document.getElementById('tchibo-overview-nav').style.display='';
      document.getElementById('tchibo-full-list').style.display='none';
      document.getElementById('tchibo-full-nav').style.display='none';
    }
    function showFull(){
      document.getElementById('tchibo-overview-list').style.display='none';
      document.getElementById('tchibo-overview-nav').style.display='none';
      document.getElementById('tchibo-full-list').style.display='';
      document.getElementById('tchibo-full-nav').style.display='';
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      const link = document.getElementById('tchibo-head-link');
      if (link) link.addEventListener('click', (e)=>{ e.preventDefault(); showFull(); loadFull(1); });
      showOverview(); loadOverview(1);
    });
  })();
  </script>
</body>
</html>
