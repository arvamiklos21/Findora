<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz</title>
  <meta name="description" content="A Findora seg√≠t megtal√°lni a legjobb akci√≥kat √©s aj√°nlatokat." />
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="icon" href="assets/img/findora_mark.png" />

  <!-- OG/Twitter -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Findora" />
  <meta property="og:title" content="Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz" />
  <meta property="og:description" content="V√°logatott akci√≥k √©s aj√°nlatok." />
  <meta property="og:image" content="assets/img/findora-header.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Findora ‚Äì Ir√°nyt mutat a legjobb aj√°nlatokhoz" />
  <meta name="twitter:description" content="A legjobb akci√≥k √©s kuponok egy helyen." />
  <meta name="twitter:image" content="assets/img/findora-header.png" />

  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#0077FF; --brand2:#00BBFF; --bg:#f7f9fc; --text:#0f172a; --muted:#64748b;
      --card:#ffffff; --panel:#ffffffee; --border:#e2e8f0; --panel-blur: 12px;
      --pine-row:url("data:image/svg+xml;utf8,<?xml version='1.0'?><svg xmlns='http://www.w3.org/2000/svg' width='480' height='120' viewBox='0 0 480 120'><defs><linearGradient id='fog' x1='0' x2='0' y1='0' y2='1'><stop offset='0' stop-color='%230b1a33' stop-opacity='0.0'/><stop offset='1' stop-color='%230b1a33' stop-opacity='0.35'/></linearGradient></defs><rect width='480' height='120' fill='url(%23fog)'/><g fill='%23152a4a' opacity='0.75'><path d='M10,110 l20,-40 l20,40 z'/><path d='M60,110 l22,-44 l22,44 z'/><path d='M120,110 l18,-36 l18,36 z'/><path d='M170,110 l24,-48 l24,48 z'/><path d='M230,110 l20,-42 l20,42 z'/><path d='M290,110 l22,-44 l22,44 z'/><path d='M350,110 l18,-36 l18,36 z'/><path d='M400,110 l24,-48 l24,48 z'/></g></svg>");
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
      background:
        radial-gradient(1200px 700px at 12% -10%, rgba(0,119,255,.08), transparent 60%),
        radial-gradient(900px 600px at 110% -10%, rgba(0,187,255,.06), transparent 60%),
        var(--pine-row) bottom center/900px 220px repeat-x,
        var(--bg);
      background-attachment: fixed,fixed,fixed,fixed;
      overflow-x:hidden;
    }
    @media (max-width:640px){ body{ background-attachment: scroll,scroll,scroll,scroll; } }

    .hero{
      position:relative; z-index:3; color:#0f172a; text-align:center; padding:58px 10px 22px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.85) 0%, rgba(255,255,255,.78) 60%, rgba(255,255,255,.75) 100%),
        url('assets/img/findora-header.png') center/cover no-repeat;
      border-bottom:1px solid rgba(226,232,240,.7);
    }
    .hero-inner{max-width:1100px;margin:0 auto}
    .brand{display:flex;gap:12px;align-items:center;justify-content:center;margin-bottom:10px}
    .brand img{height:44px;border-radius:12px;background:#fff;box-shadow:0 2px 8px rgba(2,6,23,.08);border:1px solid var(--border)}
    .hero h1{font-size:clamp(20px,3.5vw,32px);font-weight:800}
    .hero p{font-size:clamp(13px,1.7vw,16px); color:#334155}
    .dev-badge{position:absolute;left:12px;top:12px;background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;padding:6px 10px;border-radius:10px;font-weight:700;font-size:13px;box-shadow:0 4px 14px rgba(0,119,255,.25)}
    .promo{margin:10px auto;background:#ffffffcc;color:#0f172a;padding:8px 12px;border-radius:14px;max-width:860px;font-weight:700;border:1px solid rgba(2,6,23,.06);backdrop-filter:saturate(140%) blur(6px)}

    .gift-row{display:flex;gap:8px;justify-content:center;margin-top:10px}
    .gift{width:26px;height:26px;position:relative;transform:rotate(3deg);filter:drop-shadow(0 6px 10px rgba(0,0,0,.12))}
    .gift:before,.gift:after{content:"";position:absolute;inset:0;border-radius:4px}
    .gift:before{background:linear-gradient(145deg,#fff,#ddd)}
    .gift:after{
      background:
        linear-gradient(0deg,transparent 45%, rgba(0,0,0,.06) 46% 54%, transparent 55%),
        linear-gradient(90deg,#e11d48,#e11d48);
      border-radius:4px}
    .gift .bow{position:absolute;top:-9px;left:50%;width:18px;height:10px;transform:translateX(-50%);border-radius:10px;background:radial-gradient(circle at 30% 40%, #ff7096, #e11d48)}

    .promo-banners{display:grid;grid-template-columns:1fr 1fr;gap:10px;max-width:1100px;margin:10px auto 0;padding:0 10px}
    .pb-card{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-radius:14px;text-decoration:none;background:#fff;border:1px solid rgba(2,6,23,.06);box-shadow:0 6px 14px rgba(2,6,23,.08);color:#0f172a}
    .pb-eyebrow{display:block;font-size:12px;letter-spacing:.06em;opacity:.85}
    .pb-title{display:block;font-weight:900;font-size:18px;line-height:1}
    .pb-cta{font-weight:800;font-size:13px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.9)}
    .pb-card.xmas{background:linear-gradient(90deg,#e11d48,#ef4444);color:#fff;border-color:transparent}
    .pb-card.bf{background:radial-gradient(120% 120% at 0% 0%, #111 0%, #000 60%);color:#e5e7eb;border-color:#111}
    .pb-card.bf .pb-cta{background:#111;color:#fff;border:1px solid #222}
    .pb-card.bf .pb-count{font-variant-numeric:tabular-nums;font-weight:900;letter-spacing:.02em;background:#0a0a0a;border:1px solid #1f2937;padding:6px 8px;border-radius:8px}
    @media (max-width:760px){ .promo-banners{grid-template-columns:1fr} }

    .topbar-wrap{position:sticky; top:0; z-index:40; backdrop-filter: blur(var(--panel-blur)); background:rgba(255,255,255,.7); border-bottom:1px solid rgba(226,232,240,.8)}
    .topbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;justify-content:center;margin:0 auto;max-width:1100px;padding:8px 6px}
    .categories{display:flex;gap:8px;justify-content:center;overflow-x:auto;padding:0 6px}
    .catbtn{border:1px solid #dbeafe;background:#ffffffc9;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:700;font-size:14px;white-space:nowrap}
    .catbtn.active{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#fff;border-color:#cfe6ff}

    .searchbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:center;margin:8px 0 0}
    .searchbar input,.searchbar button{padding:10px;border:none;border-radius:10px;font-size:14px}
    .searchbar input{min-width:220px;max-width:360px;flex:1;padding-left:36px;background:#fff url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="%2399a1ad"><path d="M21 20l-5.6-5.6a7 7 0 10-1.4 1.4L20 21l1-1zM10 16a6 6 0 110-12 6 6 0 010 12z"/></svg>') no-repeat 10px center;background-size:18px 18px; border:1px solid var(--border)}
    .searchbar button{background:linear-gradient(90deg,var(--brand),var(--brand2));color:#ffffff;font-weight:800;cursor:pointer;box-shadow:0 8px 18px rgba(0,119,255,.18)}

    /* mini nav */
    .nav-mini{position:fixed;right:12px;bottom:70px;display:flex;gap:8px;z-index:60}
    .nav-mini button{background:#ffffff;border:1px solid #e2e8f0;border-radius:999px;padding:8px 12px;font-weight:800;box-shadow:0 8px 22px rgba(2,6,23,.22);cursor:pointer}

    main{max-width:1200px;margin:22px auto;padding:0 12px; position:relative; z-index:2}
    .section{
      background:var(--panel); border:1px solid rgba(226,232,240,.85); border-radius:18px; margin-bottom:24px; box-shadow:0 10px 24px rgba(2,6,23,.10); overflow:hidden;
      content-visibility:auto; contain-intrinsic-size: 1000px 800px;
    }
    .section h2{font-size:18px;padding:10px 12px;border-bottom:1px solid #e2e8f0;background:linear-gradient(90deg,#eef6ff,#fff)}

    .grid{display:flex; flex-wrap:wrap; gap:12px; padding:12px}
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:14px; overflow:hidden;
      display:flex; flex-direction:column; min-width:220px;
      flex:1 1 calc(25% - 12px); max-width:calc(25% - 12px)
    }
    .card:hover{transform:translateY(-3px); box-shadow:0 14px 26px rgba(2,6,23,.16)}
    @media (max-width:900px){ .card{ flex:1 1 calc(33.333% - 12px); max-width:calc(33.333% - 12px); } }
    @media (max-width:640px){ .card{ flex:1 1 calc(50% - 12px); max-width:calc(50% - 12px); } }
    @media (max-width:420px){ .card{ flex:1 1 100%; max-width:100%; } }

    .thumb{height:130px;background:#eef2f7;display:flex;align-items:center;justify-content:center}
    .title{font-weight:800;margin:10px;font-size:14px;line-height:1.25;text-align:center;color:#475569}
    .price{margin:6px 12px 0; font-weight:900; text-align:center}
    .cta{display:inline-block; margin:10px auto 12px; background:linear-gradient(90deg,var(--brand),var(--brand2)); color:#fff; padding:8px 12px; border-radius:10px; font-weight:800; text-decoration:none}
    .empty{padding:18px;color:#64748b}

    footer{text-align:center;padding:20px;background:#0b3a6a;color:#fff;margin-top:24px;font-size:14px;border-top:1px solid rgba(255,255,255,.15)}

    .snow{pointer-events:none;position:fixed;inset:0;overflow:hidden;z-index:1}
    .flake{position:absolute;top:-10px;width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.9);filter:blur(.5px);animation:fall linear infinite}
    @keyframes fall{0%{transform:translateY(-10px)}100%{transform:translateY(110vh)}}

    #searchProgress{display:none; margin:6px auto 0; font-size:12px; color:#334155; background:#fff; border:1px solid var(--border); border-radius:10px; padding:6px 10px; width:max-content}
  </style>
</head>
<body>
  <div class="snow" aria-hidden="true"></div>

  <header class="hero">
    <span class="dev-badge">Folyamatos fejleszt√©s</span>
    <div class="hero-inner">
      <div class="brand">
        <img id="brandLogo" src="assets/img/findora-header.png" alt="Findora log√≥" />
        <div>
          <h1>Findora</h1>
          <p>Ir√°nyt mutat a legjobb aj√°nlatokhoz</p>
        </div>
      </div>

      <div class="gift-row" aria-hidden="true">
        <div class="gift"><div class="bow"></div></div>
        <div class="gift" style="transform:rotate(-4deg)"><div class="bow"></div></div>
        <div class="gift" style="transform:rotate(2deg)"><div class="bow"></div></div>
        <div class="gift" style="transform:rotate(-6deg)"><div class="bow"></div></div>
      </div>

      <div class="promo" role="note">üéÑ √únnepi hangulat, friss aj√°nlatokkal! ‚Äì A partnerek statikus feedr≈ël t√∂ltenek, gyors bet√∂lt√©ssel.</div>

      <div class="promo-banners" role="region" aria-label="Kiemelt akci√≥k">
        <a class="pb-card xmas" href="#akciok" aria-label="Kar√°csonyi √∂tletek">
          <div><span class="pb-eyebrow">Merry</span><span class="pb-title">Christmas</span></div>
          <div><span class="pb-cta">Aj√°nd√©k-√∂tletek ¬ª</span></div>
        </a>
        <a class="pb-card bf" href="#akciok" aria-label="Black Friday">
          <div><span class="pb-eyebrow">Black</span><span class="pb-title">Friday</span></div>
          <div><span class="pb-count" id="bfCountdown">Bet√∂lt√©s‚Ä¶</span><span class="pb-cta">Legjobb √°rak ¬ª</span></div>
        </a>
      </div>
    </div>

    <div class="topbar-wrap">
      <div class="topbar">
        <nav class="categories" aria-label="Kateg√≥ri√°k">
          <button class="catbtn active" data-cat="all">F≈ëoldal</button>
          <button class="catbtn" data-cat="home">üè† Otthon</button>
          <!-- A t√∂bbi gomb maradhat, de a szekci√≥juk rejtve -->
          <button class="catbtn" data-cat="games">üïπÔ∏è J√°t√©kok</button>
          <button class="catbtn" data-cat="tech">üíª Tech</button>
          <button class="catbtn" data-cat="vision">üëì L√°t√°s</button>
          <button class="catbtn" data-cat="travel">‚úàÔ∏è Utaz√°s</button>
        </nav>

        <form id="searchFormAll" class="searchbar" role="search" action="">
          <input id="qAll" name="q" type="search" placeholder="Keres√©s a Tchibo teljes feedben‚Ä¶" aria-label="Keres√©s (F≈ëoldal)" />
          <button type="submit" aria-label="Keres√©s ind√≠t√°sa">Keres√©s</button>
        </form>
        <div id="searchProgress">Keres√©s‚Ä¶</div>
      </div>
    </div>
  </header>

  <!-- mini nav -->
  <div class="nav-mini">
    <button id="homeBtn" title="F≈ëoldal">Home</button>
    <button id="backBtn" title="Vissza">Vissza</button>
  </div>

  <main>

    <!-- ========= AKCI√ìS BLOKKOK ‚Äì LEGFEL√úL, CSAK TCHIBO ALAPJ√ÅN ========= -->
    <section class="section" id="akciok">
      <h2>Akci√≥k</h2>

      <div class="section">
        <h2>üéÅ √únnepi aj√°nlatok Boltokt√≥l</h2>
        <div class="grid" id="xmas-list"></div>
        <div class="grid" id="xmas-nav" style="padding-top:0"></div>
      </div>

      <div class="section">
        <h2>‚àí10‚Äì24% le√©rt√©kel√©s</h2>
        <div class="grid" id="sale10-list"></div>
        <div class="grid" id="sale10-nav" style="padding-top:0"></div>
      </div>

      <div class="section">
        <h2>‚ö° ‚àí25‚Äì49% le√°raz√°s</h2>
        <div class="grid" id="sale25-list"></div>
        <div class="grid" id="sale25-nav" style="padding-top:0"></div>
      </div>

      <div class="section">
        <h2>üí• Hihetetlen ‚àí50%+</h2>
        <div class="grid" id="sale50-list"></div>
        <div class="grid" id="sale50-nav" style="padding-top:0"></div>
      </div>
    </section>

    <!-- ========= F≈êOLDAL ‚Äì TCHIBO (6/lap, fejl√©c katt ‚Üí 20/lap) ========= -->
    <section class="section" id="osszes">
      <h2>F≈ëoldal ‚Äì <a href="#tchibo-full" id="tchibo-head-link" style="text-decoration:underline;font-weight:900;">Tchibo</a></h2>
      <div class="grid" id="tchibo-overview-list">
        <div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div>
      </div>
      <div id="tchibo-overview-nav" class="grid" style="padding-top:0"></div>

      <!-- 20/lap teljes ‚Äì partner keres≈ëvel -->
      <div id="tchibo-full-wrap" style="display:none; padding:12px;">
        <form id="searchFormTch" class="searchbar" role="search" action="" style="margin:0 0 8px">
          <input id="qTch" name="qTch" type="search" placeholder="Keres√©s a Tchibo term√©kei k√∂z√∂tt‚Ä¶" aria-label="Keres√©s (Tchibo)" />
          <button type="submit" aria-label="Keres√©s ind√≠t√°sa">Keres√©s</button>
        </form>
        <div class="grid" id="tchibo-full-list"></div>
        <div id="tchibo-full-nav" class="grid" style="padding-top:0"></div>
      </div>
    </section>

    <!-- ========= OTTHON ‚Äì Tchibo 6/lap (akci√≥ n√©lk√ºl) ========= -->
    <section class="section" id="otthon">
      <h2>Otthon ‚Äì Tchibo</h2>
      <div class="grid" id="tchibo-home-list">
        <div class="card"><div class="thumb">‚è≥</div><div class="title">T√∂lt√©s‚Ä¶</div></div>
      </div>
      <div id="tchibo-home-nav" class="grid" style="padding-top:0"></div>
    </section>

    <!-- A t√∂bbi kateg√≥ria SZEKCI√ìJA most REJTETT, hogy ne legyen √ºres keret -->
    <section class="section" id="games" style="display:none"></section>
    <section class="section" id="tech" style="display:none"></section>
    <section class="section" id="vision" style="display:none"></section>
    <section class="section" id="travel" style="display:none"></section>
  </main>

  <footer>
    ¬© 2025 Findora ‚Ä¢ Az oldalon affiliate linkek lehetnek.
  </footer>

  <script>
    // ===== apr√≥ vizu√°lok =====
    (function snow(){
      const wrap=document.querySelector('.snow');
      const isMobile = matchMedia('(max-width: 640px)').matches;
      const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const COUNT = prefersReduced ? 0 : (isMobile ? 14 : 28);
      for(let i=0;i<COUNT;i++){
        const f=document.createElement('div');
        f.className='flake';
        f.style.left = Math.random()*100 + 'vw';
        const dur = (isMobile ? 10 : 8) + Math.random()*10;
        f.style.animationDuration = dur + 's';
        f.style.animationDelay = (Math.random()*-dur) + 's';
        f.style.opacity = (0.45 + Math.random()*0.35).toFixed(2);
        const size = (isMobile ? 1.5 : 2) + Math.random()*4;
        f.style.width = f.style.height = size + 'px';
        wrap.appendChild(f);
      }
    })();

    document.getElementById('homeBtn').onclick = ()=>location.href = location.origin + location.pathname;
    document.getElementById('backBtn').onclick = ()=>history.back();

    (function promoLogicTZ(){
      const now = new Date();
      const y = now.getFullYear();
      function lastFridayOfNovember(year){
        const d = new Date(year, 10, 30);
        while(d.getDay() !== 5){ d.setDate(d.getDate()-1); }
        d.setHours(0,0,0,0);
        return d;
      }
      const bfDate = lastFridayOfNovember(y);
      const el = document.getElementById('bfCountdown');
      if(el){
        const pad = n => String(n).padStart(2,'0');
        function tick(){
          const now = new Date();
          const diff = bfDate - now;
          if(diff <= 0){ el.textContent = "Ma!"; return; }
          const d = Math.floor(diff/86400000);
          const h = Math.floor((diff%86400000)/3600000);
          const m = Math.floor((diff%3600000)/60000);
          el.textContent = `${pad(d)} nap ${pad(h)}:${pad(m)}`;
          setTimeout(tick, 20000);
        }
        tick();
      }
    })();

    // ====== util ======
    const API_BASE = location.hostname.endsWith('findora.hu') ? 'https://www.findora.hu' : location.origin;
    const hasDl = true;
    const tchiboDl = (u) => hasDl ? `${API_BASE}/api/dl?u=${encodeURIComponent(u)}&p=tchibo` : u;

    const TCH_META_URL = '/feeds/tchibo/meta.json';
    const TCH_PAGE_URL = n => `/feeds/tchibo/page-${String(n).padStart(4,'0')}.json`;

    let TCH_META=null;
    const TCH_CACHE=new Map();
    let ALL_INDEX = [];

    function priceText(v){
      if (Number.isFinite(v)) return v.toLocaleString('hu-HU') + ' Ft';
      if (typeof v === 'string' && v.trim()) return v;
      return '‚Äî';
    }
    function firstUrl(it){ return it?.url || it?.link || it?.deeplink || ''; }
    function basePath(u){ try{ const x=new URL(u); return x.origin + x.pathname; }catch(_){ return String(u||'').split('#')[0].split('?')[0]; } }
    function imgPath(u){ return String(u||'').split('#')[0].split('?')[0]; }
    function dedupeBySizeKeepColor(items){
      const seen = new Set(), out=[];
      for (const it of (items||[])){
        const key = basePath(firstUrl(it)) + '|' + imgPath(it?.img||'');
        if (key && !seen.has(key)){ seen.add(key); out.push(it); }
      }
      return out;
    }
    const renderCardsSimple = (items)=>{
      const deduped = dedupeBySizeKeepColor(items);
      return (deduped||[]).map(it=>{
        const raw = firstUrl(it);
        return `
          <div class="card">
            <div class="thumb">
              ${it?.img ? `<img src="${it.img}" alt="" loading="lazy" style="max-width:100%;max-height:100%">` : 'üõçÔ∏è'}
            </div>
            <div class="title">${it?.title || ''}</div>
            <div class="price">${priceText(it?.price)}</div>
            ${raw ? `<a class="cta" href="${tchiboDl(raw)}" target="_blank" rel="nofollow sponsored noopener noreferrer">Megn√©zem</a>` : ''}
          </div>`;
      }).join('');
    };

    async function getMeta(){
      if (TCH_META) return TCH_META;
      const r = await fetch(TCH_META_URL, {cache:'no-cache'});
      if(!r.ok) throw new Error('meta.json nem el√©rhet≈ë');
      TCH_META = await r.json();
      return TCH_META;
    }
    async function getPage(n){
      const key = `page-${String(n).padStart(4,'0')}`;
      if (TCH_CACHE.has(key)) return TCH_CACHE.get(key);
      const r = await fetch(TCH_PAGE_URL(n), {cache:'no-cache'});
      if(!r.ok) throw new Error(`page ${key} nem el√©rhet≈ë`);
      const d = await r.json();
      TCH_CACHE.set(key, d);
      return d;
    }
    async function fetchItems(offset, limit){
      const meta = await getMeta();
      const srcPageSize = meta.pageSize || 300;
      const total = meta.total ?? (meta.pages * srcPageSize);
      const out = [];
      for (let i=offset; out.length<limit && i<total; i++){
        const pageNum = Math.floor(i/srcPageSize) + 1;
        const innerIdx = i % srcPageSize;
        const page = await getPage(pageNum);
        const arr = page?.items || [];
        if (innerIdx < arr.length) out.push(arr[innerIdx]);
        if (arr.length === 0) break;
      }
      return { items: out, total };
    }

    // ===== F≈ëoldal ‚Äì 6/lap =====
    const OVERVIEW_SIZE = 6;
    async function loadTchiboOverview(page=1){
      try{
        const {items, total} = await fetchItems((page-1)*OVERVIEW_SIZE, OVERVIEW_SIZE);
        document.getElementById('tchibo-overview-list').innerHTML =
          renderCardsSimple(items) || '<div class="empty">Nincs megjelen√≠thet≈ë aj√°nlat.</div>';
        const totalPages = Math.max(1, Math.ceil(total/OVERVIEW_SIZE));
        document.getElementById('tchibo-overview-nav').innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="loadTchiboOverview(${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="loadTchiboOverview(${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById('tchibo-overview-list').innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni (√°ttekint≈ë).</div>';
      }
    }

    // ===== Otthon ‚Äì 6/lap =====
    async function loadTchiboHome(page=1){
      try{
        const {items, total} = await fetchItems((page-1)*OVERVIEW_SIZE, OVERVIEW_SIZE);
        document.getElementById('tchibo-home-list').innerHTML =
          renderCardsSimple(items) || '<div class="empty">Nincs megjelen√≠thet≈ë aj√°nlat.</div>';
        const totalPages = Math.max(1, Math.ceil(total/OVERVIEW_SIZE));
        document.getElementById('tchibo-home-nav').innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="loadTchiboHome(${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="loadTchiboHome(${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById('tchibo-home-list').innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni (Otthon).</div>';
      }
    }

    // ===== Teljes ‚Äì 20/lap + partner-keres≈ë =====
    const FULL_SIZE = 20;
    let TCH_FILTER = '';
    async function loadTchiboFull(page=1){
      try{
        const {items:chunk, total} = await (async()=>{
          const meta = await getMeta();
          const offset = (page-1)*FULL_SIZE;
          const srcPageSize = meta.pageSize || 300;
          const total = meta.total ?? (meta.pages * srcPageSize);
          const out = [];
          for (let i=offset; out.length<FULL_SIZE && i<total; i++){
            const pageNum = Math.floor(i/srcPageSize) + 1;
            const innerIdx = i % srcPageSize;
            const pg = await getPage(pageNum);
            const arr = pg?.items || [];
            if (innerIdx < arr.length) out.push(arr[innerIdx]);
            if (arr.length === 0) break;
          }
          return {items: out, total};
        })();

        let items = chunk;
        if (TCH_FILTER){
          const q = TCH_FILTER.toLowerCase();
          const filterFn = it=>((it?.title||'')+(it?.desc||'')).toLowerCase().includes(q);
          if (!items.some(filterFn)){
            const {items:extra} = await fetchItems(0, FULL_SIZE*5);
            items = extra.filter(filterFn).slice(0, FULL_SIZE);
          }else{
            items = items.filter(filterFn);
          }
        }
        document.getElementById('tchibo-full-list').innerHTML =
          renderCardsSimple(items) || '<div class="empty">Nincs tal√°lat.</div>';

        const totalPages = Math.max(1, Math.ceil(total/FULL_SIZE));
        document.getElementById('tchibo-full-nav').innerHTML = `
          <button class="cta" ${page<=1?'disabled':''} onclick="loadTchiboFull(${page-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none"> ${page}/${totalPages} </span>
          <button class="cta" ${page>=totalPages?'disabled':''} onclick="loadTchiboFull(${page+1})">K√∂vetkez≈ë</button>`;
      }catch(e){
        console.error(e);
        document.getElementById('tchibo-full-list').innerHTML = '<div class="empty">Nem siker√ºlt bet√∂lteni (teljes).</div>';
      }
    }
    function showOverview(){
      document.getElementById('tchibo-overview-list').parentElement.style.display = '';
      document.getElementById('tchibo-overview-nav').style.display = '';
      document.getElementById('tchibo-full-wrap').style.display = 'none';
    }
    function showFull(){
      document.getElementById('tchibo-overview-list').parentElement.style.display = 'none';
      document.getElementById('tchibo-overview-nav').style.display = 'none';
      document.getElementById('tchibo-full-wrap').style.display = '';
    }

    // ===== Gyors index akci√≥khoz =====
    async function ensureAllIndex(){
      if (ALL_INDEX.length) return;
      try{
        const meta = await getMeta();
        const want = Math.min((meta.total||0), (meta.pageSize||300)*4);
        const out = [];
        for (let i=0;i<want;i++){
          const pageNum = Math.floor(i/(meta.pageSize||300))+1;
          const innerIdx = i % (meta.pageSize||300);
          const pg = await getPage(pageNum);
          const arr = pg?.items || [];
          if (innerIdx < arr.length) out.push(arr[innerIdx]);
        }
        ALL_INDEX = dedupeBySizeKeepColor(out);
      }catch(e){ console.warn('AllIndex skip:', e); }
    }
    function getDiscountNumber(it){
      if (Number.isFinite(it?.discount)) return it.discount;
      const txt = ((it?.title||'')+' '+(it?.desc||'')).toLowerCase();
      const m = txt.match(/-?\s?(\d{1,3})\s?%/);
      return m ? parseInt(m[1],10) : null;
    }
    function paginate(arr, size){ const pages=[]; for(let i=0;i<arr.length;i+=size) pages.push(arr.slice(i,i+size)); return pages.length?pages:[[]]; }
    function renderPagedBlock(items, listElId, navElId){
      const PAGE=6;
      const pages = paginate(items, PAGE);
      let cur = 1;
      function draw(){
        const list = document.getElementById(listElId);
        const nav  = document.getElementById(navElId);
        list.innerHTML = pages[cur-1].length ? renderCardsSimple(pages[cur-1]) : '<div class="empty">Sajnos nincsennek Akci√≥k !! :(</div>';
        nav.innerHTML = `
          <button class="cta" ${cur<=1?'disabled':''} onclick="(${fnName}).go(${cur-1})">El≈ëz≈ë</button>
          <span class="cta" style="pointer-events:none">${cur}/${pages.length}</span>
          <button class="cta" ${cur>=pages.length?'disabled':''} onclick="(${fnName}).go(${cur+1})">K√∂vetkez≈ë</button>`;
      }
      const fnName = listElId.replace(/-/g,'_')+'_pager';
      window[fnName] = { go:(n)=>{ cur=n; draw(); } };
      draw();
    }
    async function buildSaleBlocks(){
      try{
        await ensureAllIndex();
        const items = ALL_INDEX;
        const in10 = items.filter(it=>{ const d=getDiscountNumber(it); return d!==null && d>=10 && d<=24; });
        const in25 = items.filter(it=>{ const d=getDiscountNumber(it); return d!==null && d>=25 && d<=49; });
        const in50 = items.filter(it=>{ const d=getDiscountNumber(it); return d!==null && d>=50;  });
        const xmas = items.filter(it=>{
          const txt=((it?.title||'')+' '+(it?.desc||'')).toLowerCase();
          return /kar√°csony|xmas|√ºnnepi|aj√°nd√©k/.test(txt);
        });
        renderPagedBlock(xmas, 'xmas-list','xmas-nav');
        renderPagedBlock(in10, 'sale10-list','sale10-nav');
        renderPagedBlock(in25, 'sale25-list','sale25-nav');
        renderPagedBlock(in50, 'sale50-list','sale50-nav');
      }catch(e){
        console.warn('Akci√≥ blokkok hiba', e);
        ['xmas-list','sale10-list','sale25-list','sale50-list'].forEach(id=>{
          const el=document.getElementById(id);
          if(el) el.innerHTML = '<div class="empty">Sajnos nincsennek Akci√≥k !! :(</div>';
        });
      }
    }

    // ===== Kateg√≥ria gombok ‚Äì g√∂rget√©s =====
    document.querySelectorAll(".catbtn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        document.querySelectorAll(".catbtn").forEach(b=>b.classList.toggle("active", b===btn));
        const map = { all:'osszes', home:'otthon', games:'games', tech:'tech', vision:'vision', travel:'travel' };
        const t = document.getElementById(map[btn.dataset.cat] || 'osszes');
        if(t){ t.scrollIntoView({behavior:'smooth'}); }
      });
    });

    // ===== esem√©nyek =====
    document.getElementById('tchibo-head-link').addEventListener('click', (e)=>{
      e.preventDefault(); showFull(); loadTchiboFull(1);
    });
    document.getElementById('searchFormAll').addEventListener('submit', (e)=>{
      e.preventDefault(); runAllSearch_FullFeed(document.getElementById('qAll').value||'');
    });
    document.getElementById('searchFormTch').addEventListener('submit', (e)=>{
      e.preventDefault(); TCH_FILTER = document.getElementById('qTch').value||''; loadTchiboFull(1);
    });

    // ===== Teljes Tchibo keres√©s =====
    let SEARCH_RUN_ID = 0;
    const MAX_RESULTS = 240;
    function matchesNeedle(it, needle){
      const t = (it?.title||'').toLowerCase();
      const d = (it?.desc||'').toLowerCase();
      return t.includes(needle) || d.includes(needle);
    }
    async function runAllSearch_FullFeed(q){
      const needle = (q||'').trim().toLowerCase();
      const listEl = document.getElementById('tchibo-overview-list');
      const navEl  = document.getElementById('tchibo-overview-nav');
      const progEl = document.getElementById('searchProgress');

      if (!needle){
        progEl.style.display = 'none';
        await loadTchiboOverview(1);
        return;
      }

      const myRun = ++SEARCH_RUN_ID;
      listEl.innerHTML = '<div class="card"><div class="thumb">üîé</div><div class="title">Keres√©s a teljes Tchibo feedben‚Ä¶</div></div>';
      navEl.innerHTML = '';

      try{
        const meta = await getMeta();
        const totalPages = meta.pages || Math.ceil((meta.total||0)/(meta.pageSize||300));
        const seen = new Set();
        const results = [];

        progEl.style.display = 'inline-block';
        progEl.textContent = `Keres√©s: 0/${totalPages} oldal‚Ä¶`;

        for (let p=1; p<=totalPages; p++){
          if (myRun !== SEARCH_RUN_ID) return;
          const page = await getPage(p);
          const items = page?.items || [];
          for (const it of items){
            if (myRun !== SEARCH_RUN_ID) return;
            if (!needle || matchesNeedle(it, needle)){
              const key = basePath(firstUrl(it)) + '|' + imgPath(it?.img||'');
              if (!seen.has(key)){
                seen.add(key);
                results.push(it);
                if (results.length >= MAX_RESULTS) break;
              }
            }
          }
          progEl.textContent = `Keres√©s: ${p}/${totalPages} oldal‚Ä¶ (${results.length} tal√°lat)`;
          if (results.length >= MAX_RESULTS) break;
        }

        if (myRun !== SEARCH_RUN_ID) return;
        progEl.style.display = 'none';
        listEl.innerHTML = results.length ? renderCardsSimple(results) : '<div class="empty">Nincs tal√°lat.</div>';
        navEl.innerHTML = '';
      }catch(e){
        console.error(e);
        progEl.style.display = 'none';
        listEl.innerHTML = '<div class="empty">Hiba t√∂rt√©nt a keres√©s k√∂zben.</div>';
      }
    }

    // ===== indul√°s =====
    (async function init(){
      await loadTchiboOverview(1); // F≈ëoldal: Tchibo 6/lap
      await loadTchiboHome(1);     // Otthon: Tchibo 6/lap
      await buildSaleBlocks();     // Akci√≥k: Tchibo alapj√°n
    })();
  </script>
</body>
</html>
